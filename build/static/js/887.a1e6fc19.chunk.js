"use strict";(self.webpackChunkgenetous_manage_apps=self.webpackChunkgenetous_manage_apps||[]).push([[887],{8736:(e,t,s)=>{s.r(t),s.d(t,{Dataservice:()=>be,default:()=>xe});var i=s(2791),l=s(4880),a=s(4846),n=s(2439),o=s(8983),r=s(184);const c={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},h={color:"#f7f2f2"},d={float:"right"},p={height:"620px","overflow-y":"scroll"},m=["not","in","eq"];class u extends i.Component{constructor(e){super(e),this.state={collectionCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",addRoleSpinner:!1,compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var i=s.findIndex((e=>e.id===t));return s[i].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===s));return t==i[l].activeKey}componentDidMount(){this.getCreateCollectionRules()}async getCreateCollectionRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:this.props.service,methodContentType:"collection",methodType:"create"},t=this.state.collectionCreateRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({collectionCreateRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,i,l){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:h,icon:n.q})})})}),"object"==typeof e&&Object.keys(e).map(((c,d)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,c,s,i,l,d),value:c,name:this.getValueType(e[c]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,c,s,i,l),placeholder:m.indexOf(c)<0?"value":"values with comma",value:m.indexOf(c)<0?e[c]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+c+"_"+s+"_"+i+"_"+l,onChange:this.typeChanged.bind(this,t,c,s,i,l,d),value:this.getValueType(e[c]),disabled:e[c].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,c,s,i,l),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==d&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:h,icon:n.q})})})]}),m.indexOf(c)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[c].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,c,s,i,l)})))})]})))]})}getArrayItems(e,t,s,i,l,a){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:d,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,i,l,a,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,i,l,a,n){var o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((t,s)=>{if(a==s)if(m.indexOf(n.target.value)<0)c[n.target.value]=r.contentData[e][t];else{var i=this.getValueAsArrayByType(r.contentData[e][t],n.target.name);c[n.target.value]=i}else c[t]=r.contentData[e][t]})),r.contentData[e]=c,this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}typeChanged(e,t,s,i,l,a,n){var o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((s,i)=>{if(a==i)if(m.indexOf(t)<0)c[t]=this.convert(r.contentData[e][s],n.target.value);else{var l=this.convert(r.contentData[e][s],n.target.value);c[t]=l}else c[s]=r.contentData[e][s]})),r.contentData[e]=c,this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}removeContentDataSubKey(e,t,s,i,l){var a=[...this.state.collectionCreateRules];delete a[0].roleRules.permissions[s][l].collections[i].contentData[e][t],this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}removeContentDataSubKeyArray(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][l].collections[i];const r=o.contentData[e][t].indexOf(a);r>-1&&o.contentData[e][t].splice(r,1),this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}changeContentDataSubKey(e,t,s,i,l,a){var n=document.getElementById(e+"_"+t+"_"+s+"_"+i+"_"+l),o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i];if(m.indexOf(t)<0)r.contentData[e][t]=a.target.value;else if(a.target.value.toString().indexOf(",")>=0){var c=this.getValueAsArrayByType(a.target.value,n.value);switch(n.value){case"string":c[0]&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0]);break;case"number":!isNaN(c[0])&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0])}a.target.value=""}else""==a.target.value.toString().trim()&&(a.target.value="");this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}addNewContentDataSub(e,t,s,i){for(var l=[...this.state.collectionCreateRules],a=l[0].roleRules.permissions[t][i].collections[s],n=0;n<this.state.compare.length;++n)if(!(this.state.compare[n]in a.contentData[e])){(n>0&&a.contentData[e][this.state.compare[n-1]].length>0||0==n)&&(a.contentData[e][this.state.compare[n]]=[]);break}this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentDataKey(e,t,s,i){var l=[...this.state.collectionCreateRules];delete l[0].roleRules.permissions[t][i].collections[s].contentData[e],this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}changeContentDataKey(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[t][i].collections[s],r={};Object.keys(o.contentData).map(((e,t)=>{l==t?r[a.target.value]=o.contentData[e]:r[e]=o.contentData[e]})),o.contentData=r,this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}changeCollectionName(e,t,s,i){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}changeNonPermittedCollectionName(e,t,s,i){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}addNewContentData(e,t,s){var i=[...this.state.collectionCreateRules];i[0].roleRules.permissions[e][s].collections[t].contentData.newkey={},this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}addNewCollection(e,t){var s=[...this.state.collectionCreateRules];s[0].roleRules.permissions[e][t].collections.push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({collectionCreateRules:s}),this.props.setData(this.props.position,!0)}removeCollection(e,t,s){var i=[...this.state.collectionCreateRules];i[0].roleRules.permissions[e][s].collections.splice(t,1),this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}changeCK(e,t,s,i){var l=[...this.state.collectionCreateRules],a=l[0].roleRules.permissions[e][s].collections[t];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.contentKeys.indexOf(n[0])<0&&a.contentKeys.push(n[0]),i.target.value=""}this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentKeys(e,t,s,i,l){var a=[...this.state.collectionCreateRules],n=a[0].roleRules.permissions[t][i].collections[s];const o=n.contentKeys.indexOf(e);o>-1&&n.contentKeys.splice(o,1),this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}getContentKeysItems(e,t,s,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:d,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,i),class:"btn-close","aria-label":"Close"})]})]})}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var i=e.split(",");switch(t){case"string":s=i;break;case"number":i.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.props.toastShow("info","Processing...");var e=[...this.state.collectionCreateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}async setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(await this.setVisible(!1),l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;this.setVisible(!1),this.props.toastShow("info","Processing....");var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:this.props.method,methodType:"create",methodContentType:"collection",service:this.props.service,permissions:[{role:e.value,permitted:{collections:[]},nonPermitted:{collections:[]}}]}]};await this.props.newRuleAdd(t),this.getCreateCollectionRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing...");var t=e[0],s=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(i)){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions.splice(s,1),this.setState({collectionCreateRules:l})}}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Collection Create"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsxs)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),disabled:this.state.addRoleSpinner,children:[(0,r.jsx)(o.LQ,{component:"span",size:"sm",variant:"grow","aria-hidden":"true",hidden:!this.state.addRoleSpinner,className:"mx-1"}),"Create Role"]})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:p,children:this.state.collectionCreateRules.length>0&&this.state.collectionCreateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:d,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:h,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:c,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:c,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:c,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Collections"})}),(0,r.jsx)(o.sl,{children:e.permitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:d,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"permitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]})}),(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Collections"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeNonPermittedCollectionName.bind(this,t,s,"nonPermitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:d,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"nonPermitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]})})]})]})})))})]})}}const b=u;var x=s(577);s(6898),s(5462);const j={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},y={color:"#f7f2f2"},g={float:"right"},v={height:"620px","overflow-y":"scroll"},C=["not","in","eq"];class N extends i.Component{constructor(e){super(e),this.state={relationCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var i=s.findIndex((e=>e.id===t));return s[i].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===s));return t==i[l].activeKey}componentDidMount(){this.getCreateRelationRules()}async getCreateRelationRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"dataservice",methodContentType:"relation",methodType:"create"},t=this.state.relationCreateRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({relationCreateRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,i,l){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:y,icon:n.q})})})}),"object"==typeof e&&Object.keys(e).map(((c,h)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,c,s,i,l,h),value:c,name:this.getValueType(e[c]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,c,s,i,l),placeholder:C.indexOf(c)<0?"value":"values with comma",value:C.indexOf(c)<0?e[c]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+c+"_"+s+"_"+i+"_"+l,onChange:this.typeChanged.bind(this,t,c,s,i,l,h),value:this.getValueType(e[c]),disabled:e[c].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,c,s,i,l),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==h&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:y,icon:n.q})})})]}),C.indexOf(c)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[c].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,c,s,i,l)})))})]})))]})}getArrayItems(e,t,s,i,l,a){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,i,l,a,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,i,l,a,n){var o=[...this.state.relationCreateRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((t,s)=>{if(a==s)if(C.indexOf(n.target.value)<0)c[n.target.value]=r.contentData[e][t];else{var i=this.getValueAsArrayByType(r.contentData[e][t],n.target.name);c[n.target.value]=i}else c[t]=r.contentData[e][t]})),r.contentData[e]=c,this.setState({relationCreateRules:o}),this.props.setData(this.props.position,!0)}typeChanged(e,t,s,i,l,a,n){var o=[...this.state.relationCreateRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((s,i)=>{if(a==i)if(C.indexOf(t)<0)c[t]=this.convert(r.contentData[e][s],n.target.value);else{var l=this.convert(r.contentData[e][s],n.target.value);c[t]=l}else c[s]=r.contentData[e][s]})),r.contentData[e]=c,this.setState({relationCreateRules:o}),this.props.setData(this.props.position,!0)}removeContentDataSubKey(e,t,s,i,l){var a=[...this.state.relationCreateRules];delete a[0].roleRules.permissions[s][l].collections[i].contentData[e][t],this.setState({relationCreateRules:a}),this.props.setData(this.props.position,!0)}removeContentDataSubKeyArray(e,t,s,i,l,a){var n=[...this.state.relationCreateRules],o=n[0].roleRules.permissions[s][l].collections[i];const r=o.contentData[e][t].indexOf(a);r>-1&&o.contentData[e][t].splice(r,1),this.setState({relationCreateRules:n}),this.props.setData(this.props.position,!0)}changeContentDataSubKey(e,t,s,i,l,a){var n=document.getElementById(e+"_"+t+"_"+s+"_"+i+"_"+l),o=[...this.state.relationCreateRules],r=o[0].roleRules.permissions[s][l].collections[i];if(C.indexOf(t)<0)r.contentData[e][t]=a.target.value;else if(a.target.value.toString().indexOf(",")>=0){var c=this.getValueAsArrayByType(a.target.value,n.value);switch(n.value){case"string":c[0]&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0]);break;case"number":!isNaN(c[0])&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0])}a.target.value=""}else""==a.target.value.toString().trim()&&(a.target.value="");this.setState({relationCreateRules:o}),this.props.setData(this.props.position,!0)}addNewContentDataSub(e,t,s,i){for(var l=[...this.state.relationCreateRules],a=l[0].roleRules.permissions[t][i].collections[s],n=0;n<this.state.compare.length;++n)if(!(this.state.compare[n]in a.contentData[e])){(n>0&&a.contentData[e][this.state.compare[n-1]].length>0||0==n)&&(a.contentData[e][this.state.compare[n]]=[]);break}this.setState({relationCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentDataKey(e,t,s,i){var l=[...this.state.relationCreateRules];delete l[0].roleRules.permissions[t][i].collections[s].contentData[e],this.setState({relationCreateRules:l}),this.props.setData(this.props.position,!0)}changeContentDataKey(e,t,s,i,l,a){var n=[...this.state.relationCreateRules],o=n[0].roleRules.permissions[t][i].collections[s],r={};Object.keys(o.contentData).map(((e,t)=>{l==t?r[a.target.value]=o.contentData[e]:r[e]=o.contentData[e]})),o.contentData=r,this.setState({relationCreateRules:n}),this.props.setData(this.props.position,!0)}changeCollectionName(e,t,s,i){var l=[...this.state.relationCreateRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({relationCreateRules:l}),this.props.setData(this.props.position,!0)}changeNonPermittedCollectionName(e,t,s,i){var l=[...this.state.relationCreateRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({relationCreateRules:l}),this.props.setData(this.props.position,!0)}addNewContentData(e,t,s){var i=[...this.state.relationCreateRules];i[0].roleRules.permissions[e][s].collections[t].contentData.newkey={},this.setState({relationCreateRules:i}),this.props.setData(this.props.position,!0)}addNewCollection(e,t){var s=[...this.state.relationCreateRules];s[0].roleRules.permissions[e][t].collections.push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({relationCreateRules:s}),this.props.setData(this.props.position,!0)}removeCollection(e,t,s){var i=[...this.state.relationCreateRules];i[0].roleRules.permissions[e][s].collections.splice(t,1),this.setState({relationCreateRules:i}),this.props.setData(this.props.position,!0)}changeCK(e,t,s,i){var l=[...this.state.relationCreateRules],a=l[0].roleRules.permissions[e][s].collections[t];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.contentKeys.indexOf(n[0])<0&&a.contentKeys.push(n[0]),i.target.value=""}this.setState({relationCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentKeys(e,t,s,i,l){var a=[...this.state.relationCreateRules],n=a[0].roleRules.permissions[t][i].collections[s];const o=n.contentKeys.indexOf(e);o>-1&&n.contentKeys.splice(o,1),this.setState({relationCreateRules:a}),this.props.setData(this.props.position,!0)}getContentKeysItems(e,t,s,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,i),class:"btn-close","aria-label":"Close"})]})]})}addNewMainSub(e,t){var s=[...this.state.relationCreateRules];s[0].roleRules.permissions[e][t].mainSub.push({main:"mainCollectionName",sub:[]}),this.setState({relationCreateRules:s}),this.props.setData(this.props.position,!0)}removeMainSub(e,t,s){var i=[...this.state.relationCreateRules];i[0].roleRules.permissions[e][s].mainSub.splice(t,1),this.setState({relationCreateRules:i}),this.props.setData(this.props.position,!0)}mainCollectionChange(e,t,s,i){var l=[...this.state.relationCreateRules];l[0].roleRules.permissions[e][s].mainSub[t].main=i.target.value,this.setState({relationCreateRules:l}),this.props.setData(this.props.position,!0)}changeSub(e,t,s,i){var l=[...this.state.relationCreateRules],a=l[0].roleRules.permissions[e][s].mainSub[t];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.sub.indexOf(n[0])<0&&a.sub.push(n[0]),i.target.value=""}this.setState({relationCreateRules:l}),this.props.setData(this.props.position,!0)}getMainSubItems(e,t,s,i,l){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeSub.bind(this,t,s,i,l),class:"btn-close","aria-label":"Close"})]})]})}removeSub(e,t,s,i,l){var a=[...this.state.relationCreateRules];a[0].roleRules.permissions[e][i].mainSub[t].sub.splice(s,1),this.setState({relationCreateRules:a}),this.props.setData(this.props.position,!0)}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var i=e.split(",");switch(t){case"string":s=i;break;case"number":i.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.relationCreateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;this.setVisible(!1),this.props.toastShow("info","Processing....");var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/dataservice/add/relation",methodType:"create",methodContentType:"relation",service:"dataservice",permissions:[{role:e.value,permitted:{collections:[],mainSub:[]},nonPermitted:{collections:[],mainSub:[]}}]}]};await this.props.newRuleAdd(t),this.getCreateRelationRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing...");var t=e[0],s=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(i)){var l=[...this.state.relationCreateRules];l[0].roleRules.permissions.splice(s,1),this.setState({relationCreateRules:l})}}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Relation Create"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:v,children:this.state.relationCreateRules.length>0&&this.state.relationCreateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:g,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:y,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:j,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:j,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:j,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:[(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Child Collections"})}),(0,r.jsx)(o.sl,{children:e.permitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"permitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main-Child Collections Relation Permissions"})}),(0,r.jsx)(o.sl,{children:e.permitted.mainSub.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{children:[(0,r.jsx)("p",{children:(0,r.jsx)("b",{children:"Main collectionName :"})}),(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"main",onChange:this.mainCollectionChange.bind(this,t,s,"permitted"),value:e.main})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeMainSub.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsxs)(o.b7,{className:"col-9",children:[(0,r.jsx)("p",{children:(0,r.jsx)("b",{children:"Sub collectionNames :"})}),(0,r.jsx)(o.jO,{type:"text",name:"subCollection",onChange:this.changeSub.bind(this,t,s,"permitted"),placeholder:"Collection Names with comma"})]})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.sub.map(((e,i)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getMainSubItems(e,t,s,i,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewMainSub.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add Main-Sub Collection Relation for ",e.role]})})})})]})]}),(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:[(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Collections"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeNonPermittedCollectionName.bind(this,t,s,"nonPermitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"nonPermitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main-Child Collections Relation Permissions"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.mainSub.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{children:[(0,r.jsx)("p",{children:(0,r.jsx)("b",{children:"Main collectionName :"})}),(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"main",onChange:this.mainCollectionChange.bind(this,t,s,"nonPermitted"),value:e.main})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeMainSub.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsxs)(o.b7,{className:"col-9",children:[(0,r.jsx)("p",{children:(0,r.jsx)("b",{children:"Sub collectionNames :"})}),(0,r.jsx)(o.jO,{type:"text",name:"subCollection",onChange:this.changeSub.bind(this,t,s,"nonPermitted"),placeholder:"Collection Names with comma"})]})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.sub.map(((e,i)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getMainSubItems(e,t,s,i,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewMainSub.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add Main-Sub Collection Relation for ",e.role]})})})})]})]})]})]})})))})]})}}const R=N,D={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},S={color:"#f7f2f2"},f={float:"right"},A={height:"620px","overflow-y":"scroll"},w=["not","in","eq"];class K extends i.Component{constructor(e){super(e),this.state={collectionCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var i=s.findIndex((e=>e.id===t));return s[i].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===s));return t==i[l].activeKey}componentDidMount(){this.getUpdateCollectionRules()}async getUpdateCollectionRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:this.props.service,methodContentType:"collection",methodType:"update"},t=this.state.collectionCreateRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({collectionCreateRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,i,l){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:S,icon:n.q})})})}),"object"==typeof e&&Object.keys(e).map(((c,h)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,c,s,i,l,h),value:c,name:this.getValueType(e[c]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,c,s,i,l),placeholder:w.indexOf(c)<0?"value":"values with comma",value:w.indexOf(c)<0?e[c]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+c+"_"+s+"_"+i+"_"+l,onChange:this.typeChanged.bind(this,t,c,s,i,l,h),value:this.getValueType(e[c]),disabled:e[c].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,c,s,i,l),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==h&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:S,icon:n.q})})})]}),w.indexOf(c)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[c].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,c,s,i,l)})))})]})))]})}getArrayItems(e,t,s,i,l,a){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:f,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,i,l,a,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,i,l,a,n){var o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((t,s)=>{if(a==s)if(w.indexOf(n.target.value)<0)c[n.target.value]=r.contentData[e][t];else{var i=this.getValueAsArrayByType(r.contentData[e][t],n.target.name);c[n.target.value]=i}else c[t]=r.contentData[e][t]})),r.contentData[e]=c,this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}typeChanged(e,t,s,i,l,a,n){var o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((s,i)=>{if(a==i)if(w.indexOf(t)<0)c[t]=this.convert(r.contentData[e][s],n.target.value);else{var l=this.convert(r.contentData[e][s],n.target.value);c[t]=l}else c[s]=r.contentData[e][s]})),r.contentData[e]=c,this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}removeContentDataSubKey(e,t,s,i,l){var a=[...this.state.collectionCreateRules];delete a[0].roleRules.permissions[s][l].collections[i].contentData[e][t],this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}removeContentDataSubKeyArray(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][l].collections[i];const r=o.contentData[e][t].indexOf(a);r>-1&&o.contentData[e][t].splice(r,1),this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}changeContentDataSubKey(e,t,s,i,l,a){var n=document.getElementById(e+"_"+t+"_"+s+"_"+i+"_"+l),o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i];if(w.indexOf(t)<0)r.contentData[e][t]=a.target.value;else if(a.target.value.toString().indexOf(",")>=0){var c=this.getValueAsArrayByType(a.target.value,n.value);switch(n.value){case"string":c[0]&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0]);break;case"number":!isNaN(c[0])&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0])}a.target.value=""}else""==a.target.value.toString().trim()&&(a.target.value="");this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}addNewContentDataSub(e,t,s,i){for(var l=[...this.state.collectionCreateRules],a=l[0].roleRules.permissions[t][i].collections[s],n=0;n<this.state.compare.length;++n)if(!(this.state.compare[n]in a.contentData[e])){(n>0&&a.contentData[e][this.state.compare[n-1]].length>0||0==n)&&(a.contentData[e][this.state.compare[n]]=[]);break}this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentDataKey(e,t,s,i){var l=[...this.state.collectionCreateRules];delete l[0].roleRules.permissions[t][i].collections[s].contentData[e],this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}changeContentDataKey(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[t][i].collections[s],r={};Object.keys(o.contentData).map(((e,t)=>{l==t?r[a.target.value]=o.contentData[e]:r[e]=o.contentData[e]})),o.contentData=r,this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}changeCollectionName(e,t,s,i){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}changeNonPermittedCollectionName(e,t,s,i){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}addNewContentData(e,t,s){var i=[...this.state.collectionCreateRules];i[0].roleRules.permissions[e][s].collections[t].contentData.newkey={},this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}addNewCollection(e,t){var s=[...this.state.collectionCreateRules];s[0].roleRules.permissions[e][t].collections.push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({collectionCreateRules:s}),this.props.setData(this.props.position,!0)}removeCollection(e,t,s){var i=[...this.state.collectionCreateRules];i[0].roleRules.permissions[e][s].collections.splice(t,1),this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}changeCK(e,t,s,i){var l=[...this.state.collectionCreateRules],a=l[0].roleRules.permissions[e][s].collections[t];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.contentKeys.indexOf(n[0])<0&&a.contentKeys.push(n[0]),i.target.value=""}this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentKeys(e,t,s,i,l){var a=[...this.state.collectionCreateRules],n=a[0].roleRules.permissions[t][i].collections[s];const o=n.contentKeys.indexOf(e);o>-1&&n.contentKeys.splice(o,1),this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}getContentKeysItems(e,t,s,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:f,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,i),class:"btn-close","aria-label":"Close"})]})]})}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var i=e.split(",");switch(t){case"string":s=i;break;case"number":i.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.collectionCreateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;this.setVisible(!1),this.props.toastShow("info","Processing....");var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:this.props.method,methodType:"update",methodContentType:"collection",service:this.props.service,permissions:[{role:e.value,permitted:{collections:[]},nonPermitted:{collections:[]}}]}]};await this.props.newRuleAdd(t),this.getUpdateCollectionRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var t=e[0],s=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(i)){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions.splice(s,1),this.setState({collectionCreateRules:l})}}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Collection Update"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:A,children:this.state.collectionCreateRules.length>0&&this.state.collectionCreateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:f,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:S,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:D,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:D,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:D,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Collections"})}),(0,r.jsx)(o.sl,{children:e.permitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:f,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"permitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]})}),(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Collections"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeNonPermittedCollectionName.bind(this,t,s,"nonPermitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:f,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"nonPermitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]})})]})]})})))})]})}}const I=K,k={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},O={color:"#f7f2f2"},V={float:"right"},T={height:"620px","overflow-y":"scroll"},P=["not","in","eq"];class _ extends i.Component{constructor(e){super(e),this.state={collectionCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var i=s.findIndex((e=>e.id===t));return s[i].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===s));return t==i[l].activeKey}componentDidMount(){this.getDeleteCollectionRules()}async getDeleteCollectionRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:this.props.service,methodContentType:"collection",methodType:"delete"},t=this.state.collectionCreateRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({collectionCreateRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,i,l){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:O,icon:n.q})})})}),"object"==typeof e&&Object.keys(e).map(((c,h)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,c,s,i,l,h),value:c,name:this.getValueType(e[c]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,c,s,i,l),placeholder:P.indexOf(c)<0?"value":"values with comma",value:P.indexOf(c)<0?e[c]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+c+"_"+s+"_"+i+"_"+l,onChange:this.typeChanged.bind(this,t,c,s,i,l,h),value:this.getValueType(e[c]),disabled:e[c].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,c,s,i,l),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==h&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:O,icon:n.q})})})]}),P.indexOf(c)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[c].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,c,s,i,l)})))})]})))]})}getArrayItems(e,t,s,i,l,a){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:V,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,i,l,a,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,i,l,a,n){var o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((t,s)=>{if(a==s)if(P.indexOf(n.target.value)<0)c[n.target.value]=r.contentData[e][t];else{var i=this.getValueAsArrayByType(r.contentData[e][t],n.target.name);c[n.target.value]=i}else c[t]=r.contentData[e][t]})),r.contentData[e]=c,this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}typeChanged(e,t,s,i,l,a,n){var o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((s,i)=>{if(a==i)if(P.indexOf(t)<0)c[t]=this.convert(r.contentData[e][s],n.target.value);else{var l=this.convert(r.contentData[e][s],n.target.value);c[t]=l}else c[s]=r.contentData[e][s]})),r.contentData[e]=c,this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}removeContentDataSubKey(e,t,s,i,l){var a=[...this.state.collectionCreateRules];delete a[0].roleRules.permissions[s][l].collections[i].contentData[e][t],this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}removeContentDataSubKeyArray(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][l].collections[i];const r=o.contentData[e][t].indexOf(a);r>-1&&o.contentData[e][t].splice(r,1),this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}changeContentDataSubKey(e,t,s,i,l,a){var n=document.getElementById(e+"_"+t+"_"+s+"_"+i+"_"+l),o=[...this.state.collectionCreateRules],r=o[0].roleRules.permissions[s][l].collections[i];if(P.indexOf(t)<0)r.contentData[e][t]=a.target.value;else if(a.target.value.toString().indexOf(",")>=0){var c=this.getValueAsArrayByType(a.target.value,n.value);switch(n.value){case"string":c[0]&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0]);break;case"number":!isNaN(c[0])&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0])}a.target.value=""}else""==a.target.value.toString().trim()&&(a.target.value="");this.setState({collectionCreateRules:o}),this.props.setData(this.props.position,!0)}addNewContentDataSub(e,t,s,i){for(var l=[...this.state.collectionCreateRules],a=l[0].roleRules.permissions[t][i].collections[s],n=0;n<this.state.compare.length;++n)if(!(this.state.compare[n]in a.contentData[e])){(n>0&&a.contentData[e][this.state.compare[n-1]].length>0||0==n)&&(a.contentData[e][this.state.compare[n]]=[]);break}this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentDataKey(e,t,s,i){var l=[...this.state.collectionCreateRules];delete l[0].roleRules.permissions[t][i].collections[s].contentData[e],this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}changeContentDataKey(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[t][i].collections[s],r={};Object.keys(o.contentData).map(((e,t)=>{l==t?r[a.target.value]=o.contentData[e]:r[e]=o.contentData[e]})),o.contentData=r,this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}changeCollectionName(e,t,s,i){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}changeNonPermittedCollectionName(e,t,s,i){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}addNewContentData(e,t,s){var i=[...this.state.collectionCreateRules];i[0].roleRules.permissions[e][s].collections[t].contentData.newkey={},this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}addNewCollection(e,t){var s=[...this.state.collectionCreateRules];s[0].roleRules.permissions[e][t].collections.push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({collectionCreateRules:s}),this.props.setData(this.props.position,!0)}removeCollection(e,t,s){var i=[...this.state.collectionCreateRules];i[0].roleRules.permissions[e][s].collections.splice(t,1),this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}changeCK(e,t,s,i){var l=[...this.state.collectionCreateRules],a=l[0].roleRules.permissions[e][s].collections[t];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.contentKeys.indexOf(n[0])<0&&a.contentKeys.push(n[0]),i.target.value=""}this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentKeys(e,t,s,i,l){var a=[...this.state.collectionCreateRules],n=a[0].roleRules.permissions[t][i].collections[s];const o=n.contentKeys.indexOf(e);o>-1&&n.contentKeys.splice(o,1),this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}getContentKeysItems(e,t,s,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:V,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,i),class:"btn-close","aria-label":"Close"})]})]})}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var i=e.split(",");switch(t){case"string":s=i;break;case"number":i.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.collectionCreateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;this.setVisible(!1),this.props.toastShow("info","Processing....");var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:this.props.method,methodType:"delete",methodContentType:"collection",service:this.props.service,permissions:[{role:e.value,permitted:{collections:[]},nonPermitted:{collections:[]}}]}]};await this.props.newRuleAdd(t),this.getDeleteCollectionRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing...");var t=e[0],s=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(i)){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions.splice(s,1),this.setState({collectionCreateRules:l})}}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Collection Delete"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:T,children:this.state.collectionCreateRules.length>0&&this.state.collectionCreateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:V,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:O,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:k,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:k,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:k,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Collections"})}),(0,r.jsx)(o.sl,{children:e.permitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:V,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"permitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]})}),(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Collections"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeNonPermittedCollectionName.bind(this,t,s,"nonPermitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:V,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"nonPermitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]})})]})]})})))})]})}}const q=_,Y={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},U={color:"#f7f2f2"},B={float:"right"},H={height:"620px","overflow-y":"scroll"},Q=["not","in","eq"];class E extends i.Component{constructor(e){super(e),this.state={relationDeleteRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var i=s.findIndex((e=>e.id===t));return s[i].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===s));return t==i[l].activeKey}componentDidMount(){this.getDeleteRelationRules()}async getDeleteRelationRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"dataservice",methodContentType:"relation",methodType:"delete"},t=this.state.relationDeleteRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({relationDeleteRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,i,l){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:U,icon:n.q})})})}),"object"==typeof e&&Object.keys(e).map(((c,h)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,c,s,i,l,h),value:c,name:this.getValueType(e[c]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,c,s,i,l),placeholder:Q.indexOf(c)<0?"value":"values with comma",value:Q.indexOf(c)<0?e[c]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+c+"_"+s+"_"+i+"_"+l,onChange:this.typeChanged.bind(this,t,c,s,i,l,h),value:this.getValueType(e[c]),disabled:e[c].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,c,s,i,l),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==h&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i,l),children:(0,r.jsx)(a.Z,{style:U,icon:n.q})})})]}),Q.indexOf(c)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[c].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,c,s,i,l)})))})]})))]})}getArrayItems(e,t,s,i,l,a){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:B,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,i,l,a,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,i,l,a,n){var o=[...this.state.relationDeleteRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((t,s)=>{if(a==s)if(Q.indexOf(n.target.value)<0)c[n.target.value]=r.contentData[e][t];else{var i=this.getValueAsArrayByType(r.contentData[e][t],n.target.name);c[n.target.value]=i}else c[t]=r.contentData[e][t]})),r.contentData[e]=c,this.setState({relationDeleteRules:o}),this.props.setData(this.props.position,!0)}typeChanged(e,t,s,i,l,a,n){var o=[...this.state.relationDeleteRules],r=o[0].roleRules.permissions[s][l].collections[i],c={};Object.keys(r.contentData[e]).map(((s,i)=>{if(a==i)if(Q.indexOf(t)<0)c[t]=this.convert(r.contentData[e][s],n.target.value);else{var l=this.convert(r.contentData[e][s],n.target.value);c[t]=l}else c[s]=r.contentData[e][s]})),r.contentData[e]=c,this.setState({relationDeleteRules:o}),this.props.setData(this.props.position,!0)}removeContentDataSubKey(e,t,s,i,l){var a=[...this.state.relationDeleteRules];delete a[0].roleRules.permissions[s][l].collections[i].contentData[e][t],this.setState({relationDeleteRules:a}),this.props.setData(this.props.position,!0)}removeContentDataSubKeyArray(e,t,s,i,l,a){var n=[...this.state.relationDeleteRules],o=n[0].roleRules.permissions[s][l].collections[i];const r=o.contentData[e][t].indexOf(a);r>-1&&o.contentData[e][t].splice(r,1),this.setState({relationDeleteRules:n}),this.props.setData(this.props.position,!0)}changeContentDataSubKey(e,t,s,i,l,a){var n=document.getElementById(e+"_"+t+"_"+s+"_"+i+"_"+l),o=[...this.state.relationDeleteRules],r=o[0].roleRules.permissions[s][l].collections[i];if(Q.indexOf(t)<0)r.contentData[e][t]=a.target.value;else if(a.target.value.toString().indexOf(",")>=0){var c=this.getValueAsArrayByType(a.target.value,n.value);switch(n.value){case"string":c[0]&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0]);break;case"number":!isNaN(c[0])&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0])}a.target.value=""}else""==a.target.value.toString().trim()&&(a.target.value="");this.setState({relationDeleteRules:o}),this.props.setData(this.props.position,!0)}addNewContentDataSub(e,t,s,i){for(var l=[...this.state.relationDeleteRules],a=l[0].roleRules.permissions[t][i].collections[s],n=0;n<this.state.compare.length;++n)if(!(this.state.compare[n]in a.contentData[e])){(n>0&&a.contentData[e][this.state.compare[n-1]].length>0||0==n)&&(a.contentData[e][this.state.compare[n]]=[]);break}this.setState({relationDeleteRules:l}),this.props.setData(this.props.position,!0)}removeContentDataKey(e,t,s,i){var l=[...this.state.relationDeleteRules];delete l[0].roleRules.permissions[t][i].collections[s].contentData[e],this.setState({relationDeleteRules:l}),this.props.setData(this.props.position,!0)}changeContentDataKey(e,t,s,i,l,a){var n=[...this.state.relationDeleteRules],o=n[0].roleRules.permissions[t][i].collections[s],r={};Object.keys(o.contentData).map(((e,t)=>{l==t?r[a.target.value]=o.contentData[e]:r[e]=o.contentData[e]})),o.contentData=r,this.setState({relationDeleteRules:n}),this.props.setData(this.props.position,!0)}changeCollectionName(e,t,s,i){var l=[...this.state.relationDeleteRules];l[0].roleRules.permissions[e][s].collections[t].collectionName=i.target.value,this.setState({relationDeleteRules:l}),this.props.setData(this.props.position,!0)}changeNonPermittedCollectionName(e,t,s,i){var l=[...this.state.relationDeleteRules],a=l[0].roleRules.permissions[e][s].collections[t],n=this.getValueAsArray(i.target.value);a.collectionName=n,this.setState({relationDeleteRules:l}),this.props.setData(this.props.position,!0)}addNewContentData(e,t,s){var i=[...this.state.relationDeleteRules];i[0].roleRules.permissions[e][s].collections[t].contentData.newkey={},this.setState({relationDeleteRules:i}),this.props.setData(this.props.position,!0)}addNewCollection(e,t){var s=[...this.state.relationDeleteRules];s[0].roleRules.permissions[e][t].collections.push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({relationDeleteRules:s}),this.props.setData(this.props.position,!0)}removeCollection(e,t,s){var i=[...this.state.relationDeleteRules];i[0].roleRules.permissions[e][s].collections.splice(t,1),this.setState({relationDeleteRules:i}),this.props.setData(this.props.position,!0)}changeCK(e,t,s,i){var l=[...this.state.relationDeleteRules],a=l[0].roleRules.permissions[e][s].collections[t];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.contentKeys.indexOf(n[0])<0&&a.contentKeys.push(n[0]),i.target.value=""}this.setState({relationDeleteRules:l}),this.props.setData(this.props.position,!0)}removeContentKeys(e,t,s,i,l){var a=[...this.state.relationDeleteRules],n=a[0].roleRules.permissions[t][i].collections[s];const o=n.contentKeys.indexOf(e);o>-1&&n.contentKeys.splice(o,1),this.setState({relationDeleteRules:a}),this.props.setData(this.props.position,!0)}getContentKeysItems(e,t,s,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:B,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,i),class:"btn-close","aria-label":"Close"})]})]})}addNewMainSub(e,t){var s=[...this.state.relationDeleteRules];s[0].roleRules.permissions[e][t].mainSub.push({main:"mainCollectionName",sub:[]}),this.setState({relationDeleteRules:s}),this.props.setData(this.props.position,!0)}removeMainSub(e,t,s){var i=[...this.state.relationDeleteRules];i[0].roleRules.permissions[e][s].mainSub.splice(t,1),this.setState({relationDeleteRules:i}),this.props.setData(this.props.position,!0)}mainCollectionChange(e,t,s,i){var l=[...this.state.relationDeleteRules];l[0].roleRules.permissions[e][s].mainSub[t].main=i.target.value,this.setState({relationDeleteRules:l}),this.props.setData(this.props.position,!0)}changeSub(e,t,s,i){var l=[...this.state.relationDeleteRules],a=l[0].roleRules.permissions[e][s].mainSub[t];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.sub.indexOf(n[0])<0&&a.sub.push(n[0]),i.target.value=""}this.setState({relationDeleteRules:l}),this.props.setData(this.props.position,!0)}getMainSubItems(e,t,s,i,l){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:B,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeSub.bind(this,t,s,i,l),class:"btn-close","aria-label":"Close"})]})]})}removeSub(e,t,s,i,l){var a=[...this.state.relationDeleteRules];a[0].roleRules.permissions[e][i].mainSub[t].sub.splice(s,1),this.setState({relationDeleteRules:a}),this.props.setData(this.props.position,!0)}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var i=e.split(",");switch(t){case"string":s=i;break;case"number":i.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.relationDeleteRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;this.setVisible(!1),this.props.toastShow("info","Processing....");var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/dataservice/delete/relation",methodType:"delete",methodContentType:"relation",service:"dataservice",permissions:[{role:e.value,permitted:{collections:[],mainSub:[]},nonPermitted:{collections:[],mainSub:[]}}]}]};await this.props.newRuleAdd(t),e.value="",this.getDeleteRelationRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var t=e[0],s=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(this.props.deleteRole(i)){var l=[...this.state.relationDeleteRules];l[0].roleRules.permissions.splice(s,1),this.setState({relationDeleteRules:l})}}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Relation Delete"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:H,children:this.state.relationDeleteRules.length>0&&this.state.relationDeleteRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:B,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:U,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:Y,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:Y,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:Y,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:[(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Child Collections"})}),(0,r.jsx)(o.sl,{children:e.permitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:B,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"permitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main-Child Collections Relation Permissions"})}),(0,r.jsx)(o.sl,{children:e.permitted.mainSub.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{children:[(0,r.jsx)("p",{children:(0,r.jsx)("b",{children:"Main collectionName :"})}),(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"main",onChange:this.mainCollectionChange.bind(this,t,s,"permitted"),value:e.main})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:B,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeMainSub.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsxs)(o.b7,{className:"col-9",children:[(0,r.jsx)("p",{children:(0,r.jsx)("b",{children:"Sub collectionNames :"})}),(0,r.jsx)(o.jO,{type:"text",name:"subCollection",onChange:this.changeSub.bind(this,t,s,"permitted"),placeholder:"Collection Names with comma"})]})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.sub.map(((e,i)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getMainSubItems(e,t,s,i,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewMainSub.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add Main-Sub Collection Relation for ",e.role]})})})})]})]}),(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:[(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Child Collections"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.collections.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeNonPermittedCollectionName.bind(this,t,s,"nonPermitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:B,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((i,l)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:i,onChange:this.changeContentDataKey.bind(this,i,t,s,"nonPermitted",l)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,i,t,s,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[i],i,t,s,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data for ",e.collectionName]})})})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Collection for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main-Child Collections Relation Permissions"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.mainSub.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{children:[(0,r.jsx)("p",{children:(0,r.jsx)("b",{children:"Main collectionName :"})}),(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"main",onChange:this.mainCollectionChange.bind(this,t,s,"nonPermitted"),value:e.main})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:B,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeMainSub.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsxs)(o.b7,{className:"col-9",children:[(0,r.jsx)("p",{children:(0,r.jsx)("b",{children:"Sub collectionNames :"})}),(0,r.jsx)(o.jO,{type:"text",name:"subCollection",onChange:this.changeSub.bind(this,t,s,"nonPermitted"),placeholder:"Collection Names with comma"})]})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.sub.map(((e,i)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getMainSubItems(e,t,s,i,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewMainSub.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add Main-Sub Collection Relation for ",e.role]})})})})]})]})]})]})})))})]})}}const M=E,Z={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},z={color:"#f7f2f2"},L={float:"right"},F={height:"620px","overflow-y":"scroll"};class X extends i.Component{constructor(e){super(e),this.state={executeRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:""}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var i=s.findIndex((e=>e.id===t));return s[i].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===s));return t==i[l].activeKey}componentDidMount(){this.getDataServiceRules()}async getDataServiceRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"dataService",methodContentType:"other",methodType:"execute"},t=this.state.executeRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({executeRules:t,subKeys:s})}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/dataservice/execute",methodType:"execute",methodContentType:"other",service:"dataService",permissions:[{role:e.value,permitted:{select:!1,update:!1,delete:!1,insert:!1,with:!1,upsert:!1,drop:!1},nonPermitted:{select:!1,update:!1,delete:!1,insert:!1,with:!1,upsert:!1,drop:!1}}]}]};await this.props.newRuleAdd(t),this.getDataServiceRules()}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.executeRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var t=e[0],s=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(i)){var l=[...this.state.executeRules];l[0].roleRules.permissions.splice(s,1),this.setState({executeRules:l})}}changed(e,t,s){var i=[...this.state.executeRules];i[0].roleRules.permissions[e][t][s.target.name]=s.target.checked;this.setState({executeRules:i})}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Execute SQL"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:F,children:this.state.executeRules.length>0&&this.state.executeRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:L,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:z,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:Z,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:Z,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:Z,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Choose permitted notification types"})}),(0,r.jsx)(o.sl,{children:Object.keys(e.permitted).map(((s,i)=>(0,r.jsx)(o.EC,{onChange:this.changed.bind(this,t,"permitted"),label:s.charAt(0).toUpperCase()+s.slice(1),name:s,checked:e.permitted[s]})))})]})}),(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Choose non-permitted notification types"})}),(0,r.jsx)(o.sl,{children:Object.keys(e.nonPermitted).map(((s,i)=>(0,r.jsx)(o.EC,{onChange:this.changed.bind(this,t,"nonPermitted"),label:s.charAt(0).toUpperCase()+s.slice(1),name:s,checked:e.nonPermitted[s]})))})]})})]})]})})))})]})}}const G=X;var J=s(4889);const W={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},$={color:"#f7f2f2"},ee={float:"right"},te={height:"620px","overflow-y":"scroll"},se=["not","in","eq"];class ie extends i.Component{constructor(e){super(e),this.state={collectionCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var i=s.findIndex((e=>e.id===t));return s[i].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===s));return t==i[l].activeKey}componentDidMount(){this.getCollectionRules()}setSubKey(e){var t=[];e.length>0&&e[0].roleRules.permissions.map((e=>{var s={id:e._id,activeKey:1};t.push(s)}));this.setState({collectionCreateRules:e,subKeys:t})}async getCollectionRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:this.props.service,methodContentType:"collection",methodType:"read"},t=this.state.collectionCreateRules;t=await this.props.getRules(e),this.setSubKey(t)}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,i){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i),children:(0,r.jsx)(a.Z,{style:$,icon:n.q})})})}),"object"==typeof e&&Object.keys(e).map(((l,c)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,l,s,i,c),value:l,name:this.getValueType(e[l]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,l,s,i),placeholder:se.indexOf(l)<0?"value":"values with comma",value:se.indexOf(l)<0?e[l]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+l+"_"+s+"_"+i,onChange:this.typeChanged.bind(this,t,l,s,i,c),value:this.getValueType(e[l]),disabled:e[l].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,l,s,i),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==c&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i),children:(0,r.jsx)(a.Z,{style:$,icon:n.q})})})]}),se.indexOf(l)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[l].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,l,s,i)})))})]})))]})}getArrayItems(e,t,s,i,l){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:ee,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,i,l,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][i],r={};Object.keys(o.contentData[e]).map(((t,s)=>{if(l==s)if(se.indexOf(a.target.value)<0)r[a.target.value]=o.contentData[e][t];else{var i=this.getValueAsArrayByType(o.contentData[e][t],a.target.name);r[a.target.value]=i}else r[t]=o.contentData[e][t]})),o.contentData[e]=r,this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}typeChanged(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][i],r={};Object.keys(o.contentData[e]).map(((s,i)=>{if(l==i)if(se.indexOf(t)<0)r[t]=this.convert(o.contentData[e][s],a.target.value);else{var n=this.convert(o.contentData[e][s],a.target.value);r[t]=n}else r[s]=o.contentData[e][s]})),o.contentData[e]=r,this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}removeContentDataSubKey(e,t,s,i){var l=[...this.state.collectionCreateRules];delete l[0].roleRules.permissions[s][i].contentData[e][t],this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentDataSubKeyArray(e,t,s,i,l){var a=[...this.state.collectionCreateRules],n=a[0].roleRules.permissions[s][i];const o=n.contentData[e][t].indexOf(l);o>-1&&n.contentData[e][t].splice(o,1),this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}changeContentDataSubKey(e,t,s,i,l){var a=document.getElementById(e+"_"+t+"_"+s+"_"+i),n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][i];if(se.indexOf(t)<0)o.contentData[e][t]=l.target.value;else if(l.target.value.toString().indexOf(",")>=0){var r=this.getValueAsArrayByType(l.target.value,a.value);switch(a.value){case"string":r[0]&&o.contentData[e][t].indexOf(r[0])<0&&o.contentData[e][t].push(r[0]);break;case"number":!isNaN(r[0])&&o.contentData[e][t].indexOf(r[0])<0&&o.contentData[e][t].push(r[0])}l.target.value=""}else""==l.target.value.toString().trim()&&(l.target.value="");this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}addNewContentDataSub(e,t,s){for(var i=[...this.state.collectionCreateRules],l=i[0].roleRules.permissions[t][s],a=0;a<this.state.compare.length;++a)if(!(this.state.compare[a]in l.contentData[e])){(a>0&&l.contentData[e][this.state.compare[a-1]].length>0||0==a)&&(l.contentData[e][this.state.compare[a]]=[]);break}this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}removeContentDataKey(e,t,s){var i=[...this.state.collectionCreateRules];delete i[0].roleRules.permissions[t][s].contentData[e],this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}changeContentDataKey(e,t,s,i,l){var a=[...this.state.collectionCreateRules],n=a[0].roleRules.permissions[t][s],o={};Object.keys(n.contentData).map(((e,t)=>{i==t?o[l.target.value]=n.contentData[e]:o[e]=n.contentData[e]})),n.contentData=o,this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}addNewContentData(e,t){var s=[...this.state.collectionCreateRules];s[0].roleRules.permissions[e][t].contentData.newkey={},this.setState({collectionCreateRules:s}),this.props.setData(this.props.position,!0)}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var i=e.split(",");switch(t){case"string":s=i;break;case"number":i.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.collectionCreateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){var e=[...this.state.collectionCreateRules][0].roleRules,t=document.getElementById("newrule");if(!t.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;this.setVisible(!1),this.props.toastShow("info","Processing....");var s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:e.method,methodType:"read",methodContentType:"collection",service:this.props.service,permissions:[{role:t.value,permitted:{collectionNames:[],contentData:{},contentKeys:[]},nonPermitted:{collectionNames:[],contentData:{},contentKeys:[]}}]}]};await this.props.newRuleAdd(s),this.getCollectionRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing...");var t=e[0],s=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(i)){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions.splice(s,1),this.setState({collectionCreateRules:l})}}addExt(e,t,s,i){var l=[...this.state.collectionCreateRules],a=l[0].roleRules.permissions[e][t][s];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.indexOf(n[0])<0&&a.push(n[0]),i.target.value=""}this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}getExt(e,t,s,i,l){return(0,r.jsx)(o.b7,{md:3,children:(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:ee,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeExt.bind(this,t,s,i,l),class:"btn-close","aria-label":"Close"})]})]})})}removeExt(e,t,s,i,l){var a=[...this.state.collectionCreateRules];a[0].roleRules.permissions[e][s][i].splice(t,1),this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Get Collection"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:te,children:this.state.collectionCreateRules.length>0&&this.state.collectionCreateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:ee,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:$,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:W,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:W,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:W,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:[(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"CollectionNames"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionNames",onChange:this.addExt.bind(this,t,"permitted","collectionNames"),placeholder:"collectionNames with comma"})})}),(0,r.jsx)(o.rb,{children:e.permitted.collectionNames.map(((e,s)=>this.getExt(e,t,s,"permitted","collectionNames")))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Content Data"})}),(0,r.jsxs)(o.sl,{children:[Object.keys(e.permitted.contentData).map(((s,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:s,onChange:this.changeContentDataKey.bind(this,s,t,"permitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,s,t,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.permitted.contentData[s],s,t,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data"]})})})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Content Keys"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.addExt.bind(this,t,"permitted","contentKeys"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{children:e.permitted.contentKeys.map(((e,s)=>this.getExt(e,t,s,"permitted","contentKeys")))})]})]})]}),(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:[(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"CollectionNames"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionNames",onChange:this.addExt.bind(this,t,"nonPermitted","collectionNames"),placeholder:"collectionNames with comma"})})}),(0,r.jsx)(o.rb,{children:e.nonPermitted.collectionNames.map(((e,s)=>this.getExt(e,t,s,"nonPermitted","collectionNames")))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Content Data"})}),(0,r.jsxs)(o.sl,{children:[Object.keys(e.nonPermitted.contentData).map(((s,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:s,onChange:this.changeContentDataKey.bind(this,s,t,"nonPermitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,s,t,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.nonPermitted.contentData[s],s,t,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data"]})})})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Content Keys"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.addExt.bind(this,t,"nonPermitted","contentKeys"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{children:e.nonPermitted.contentKeys.map(((e,s)=>this.getExt(e,t,s,"nonPermitted","contentKeys")))})]})]})]})]})]})})))})]})}}const le=ie,ae={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},ne={color:"#f7f2f2"},oe={float:"right"},re={height:"620px","overflow-y":"scroll"},ce=["not","in","eq"];class he extends i.Component{constructor(e){super(e),this.state={collectionCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var i=s.findIndex((e=>e.id===t));return s[i].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===s));return t==i[l].activeKey}componentDidMount(){this.getRelationsRules()}async getRelationsRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:this.props.service,methodContentType:"relation",methodType:"read"},t=this.state.collectionCreateRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({collectionCreateRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,i){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i),children:(0,r.jsx)(a.Z,{style:ne,icon:n.q})})})}),"object"==typeof e&&Object.keys(e).map(((l,c)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,l,s,i,c),value:l,name:this.getValueType(e[l]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,l,s,i),placeholder:ce.indexOf(l)<0?"value":"values with comma",value:ce.indexOf(l)<0?e[l]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+l+"_"+s+"_"+i,onChange:this.typeChanged.bind(this,t,l,s,i,c),value:this.getValueType(e[l]),disabled:e[l].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,l,s,i),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==c&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,i),children:(0,r.jsx)(a.Z,{style:ne,icon:n.q})})})]}),ce.indexOf(l)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[l].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,l,s,i)})))})]})))]})}getArrayItems(e,t,s,i,l){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:oe,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,i,l,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][i],r={};Object.keys(o.contentData[e]).map(((t,s)=>{if(l==s)if(ce.indexOf(a.target.value)<0)r[a.target.value]=o.contentData[e][t];else{var i=this.getValueAsArrayByType(o.contentData[e][t],a.target.name);r[a.target.value]=i}else r[t]=o.contentData[e][t]})),o.contentData[e]=r,this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}typeChanged(e,t,s,i,l,a){var n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][i],r={};Object.keys(o.contentData[e]).map(((s,i)=>{if(l==i)if(ce.indexOf(t)<0)r[t]=this.convert(o.contentData[e][s],a.target.value);else{var n=this.convert(o.contentData[e][s],a.target.value);r[t]=n}else r[s]=o.contentData[e][s]})),o.contentData[e]=r,this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}removeContentDataSubKey(e,t,s,i){var l=[...this.state.collectionCreateRules];delete l[0].roleRules.permissions[s][i].contentData[e][t],this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}removeContentDataSubKeyArray(e,t,s,i,l){var a=[...this.state.collectionCreateRules],n=a[0].roleRules.permissions[s][i];const o=n.contentData[e][t].indexOf(l);o>-1&&n.contentData[e][t].splice(o,1),this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}changeContentDataSubKey(e,t,s,i,l){var a=document.getElementById(e+"_"+t+"_"+s+"_"+i),n=[...this.state.collectionCreateRules],o=n[0].roleRules.permissions[s][i];if(ce.indexOf(t)<0)o.contentData[e][t]=l.target.value;else if(l.target.value.toString().indexOf(",")>=0){var r=this.getValueAsArrayByType(l.target.value,a.value);switch(a.value){case"string":r[0]&&o.contentData[e][t].indexOf(r[0])<0&&o.contentData[e][t].push(r[0]);break;case"number":!isNaN(r[0])&&o.contentData[e][t].indexOf(r[0])<0&&o.contentData[e][t].push(r[0])}l.target.value=""}else""==l.target.value.toString().trim()&&(l.target.value="");this.setState({collectionCreateRules:n}),this.props.setData(this.props.position,!0)}addNewContentDataSub(e,t,s){for(var i=[...this.state.collectionCreateRules],l=i[0].roleRules.permissions[t][s],a=0;a<this.state.compare.length;++a)if(!(this.state.compare[a]in l.contentData[e])){(a>0&&l.contentData[e][this.state.compare[a-1]].length>0||0==a)&&(l.contentData[e][this.state.compare[a]]=[]);break}this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}removeContentDataKey(e,t,s){var i=[...this.state.collectionCreateRules];delete i[0].roleRules.permissions[t][s].contentData[e],this.setState({collectionCreateRules:i}),this.props.setData(this.props.position,!0)}changeContentDataKey(e,t,s,i,l){var a=[...this.state.collectionCreateRules],n=a[0].roleRules.permissions[t][s],o={};Object.keys(n.contentData).map(((e,t)=>{i==t?o[l.target.value]=n.contentData[e]:o[e]=n.contentData[e]})),n.contentData=o,this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}addNewContentData(e,t){var s=[...this.state.collectionCreateRules];s[0].roleRules.permissions[e][t].contentData.newkey={},this.setState({collectionCreateRules:s}),this.props.setData(this.props.position,!0)}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var i=e.split(",");switch(t){case"string":s=i;break;case"number":i.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.collectionCreateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){var e=[...this.state.collectionCreateRules][0].roleRules,t=document.getElementById("newrule");if(!t.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;this.setVisible(!1),this.props.toastShow("info","Processing....");var s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:e.method,methodType:"read",methodContentType:"relation",service:this.props.service,permissions:[{role:t.value,permitted:{relationNames:[],collectionNames:[],contentData:{},contentKeys:[]},nonPermitted:{relationNames:[],collectionNames:[],contentData:{},contentKeys:[]}}]}]};await this.props.newRuleAdd(s),this.getRelationsRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing...");var t=e[0],s=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(i)){var l=[...this.state.collectionCreateRules];l[0].roleRules.permissions.splice(s,1),this.setState({collectionCreateRules:l})}}addExt(e,t,s,i){var l=[...this.state.collectionCreateRules],a=l[0].roleRules.permissions[e][t][s];if(i.target.value.toString().indexOf(",")>=0){var n=this.getValueAsArrayByType(i.target.value,"string");n[0]&&a.indexOf(n[0])<0&&a.push(n[0]),i.target.value=""}this.setState({collectionCreateRules:l}),this.props.setData(this.props.position,!0)}getExt(e,t,s,i,l){return(0,r.jsx)(o.b7,{md:3,children:(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:oe,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeExt.bind(this,t,s,i,l),class:"btn-close","aria-label":"Close"})]})]})})}removeExt(e,t,s,i,l){var a=[...this.state.collectionCreateRules];a[0].roleRules.permissions[e][s][i].splice(t,1),this.setState({collectionCreateRules:a}),this.props.setData(this.props.position,!0)}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Get Relation"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:re,children:this.state.collectionCreateRules.length>0&&this.state.collectionCreateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:oe,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:ne,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:ae,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:ae,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:ae,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:[(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"RelationNames"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"relationNames",onChange:this.addExt.bind(this,t,"permitted","relationNames"),placeholder:"relationNames with comma"})})}),(0,r.jsx)(o.rb,{children:e.permitted.relationNames.map(((e,s)=>this.getExt(e,t,s,"permitted","relationNames")))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"CollectionNames"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionNames",onChange:this.addExt.bind(this,t,"permitted","collectionNames"),placeholder:"collectionNames with comma"})})}),(0,r.jsx)(o.rb,{children:e.permitted.collectionNames.map(((e,s)=>this.getExt(e,t,s,"permitted","collectionNames")))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Content Data"})}),(0,r.jsxs)(o.sl,{children:[Object.keys(e.permitted.contentData).map(((s,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:s,onChange:this.changeContentDataKey.bind(this,s,t,"permitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,s,t,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.permitted.contentData[s],s,t,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,"permitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data"]})})})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Content Keys"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.addExt.bind(this,t,"permitted","contentKeys"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{children:e.permitted.contentKeys.map(((e,s)=>this.getExt(e,t,s,"permitted","contentKeys")))})]})]})]}),(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:[(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"RelationNames"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"relationNames",onChange:this.addExt.bind(this,t,"nonPermitted","relationNames"),placeholder:"relationNames with comma"})})}),(0,r.jsx)(o.rb,{children:e.nonPermitted.relationNames.map(((e,s)=>this.getExt(e,t,s,"nonPermitted","relationNames")))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"CollectionNames"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionNames",onChange:this.addExt.bind(this,t,"nonPermitted","collectionNames"),placeholder:"collectionNames with comma"})})}),(0,r.jsx)(o.rb,{children:e.nonPermitted.collectionNames.map(((e,s)=>this.getExt(e,t,s,"nonPermitted","collectionNames")))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Content Data"})}),(0,r.jsxs)(o.sl,{children:[Object.keys(e.nonPermitted.contentData).map(((s,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:s,onChange:this.changeContentDataKey.bind(this,s,t,"nonPermitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,s,t,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.nonPermitted.contentData[s],s,t,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(a.Z,{icon:n.q}),"Add New Content Data"]})})})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Content Keys"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.addExt.bind(this,t,"nonPermitted","contentKeys"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{children:e.nonPermitted.contentKeys.map(((e,s)=>this.getExt(e,t,s,"nonPermitted","contentKeys")))})]})]})]})]})]})})))})]})}}const de=he,pe={cursor:"pointer",color:"rgba(33, 37, 41,0.8)","background-color":"#fff"},me={cursor:"pointer","background-color":"rgba(33, 37, 41,0.8)",color:"#fff"};var ue="Unexpected Error Occured!";class be extends i.Component{constructor(e){super(e),this.state={permissionItems:["Create Collection","Update Collection","Delete Collection","Create Relation","Delete Relation","Get Collections","Get Relations","Execute SQL"],collectionCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],redirect:!1,error:!1,errroText:"",sendApp:!1,error:!1,status:-1,message:"",lists:[!1,!1,!1,!1,!1,!1,!1],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:""},this.handleRedirect=this.handleRedirect.bind(this),this.toastShow=this.toastShow.bind(this),this.newRuleAdd=this.newRuleAdd.bind(this),this.deleteRole=this.deleteRole.bind(this),this.addUpdateRule=this.addUpdateRule.bind(this),this.getRules=this.getRules.bind(this),this.setData=this.setData.bind(this)}setActiveKey(e){return 0=={...this.state.lists}[this.state.activeKey-1]?this.setState({activeKey:e}):this.setYesNoVisible(!0,"Are you sure you want to discard all changes?","cancel",[e,this.state.activeKey]),!1}async setData(e,t){var s={...this.state.lists};s[e-1]=t,this.setState({lists:s})}async setYesNoVisible(e,t,s,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:i});else{if(l)if("cancel"===this.state.sendType){var a={...this.state.lists};a[this.state.arguments[1]-1]=!1,await this.setState({activeKey:this.state.arguments[0],lists:a})}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}handleRedirectApp(){this.state.sendApp||this.setState({sendApp:!0})}componentDidMount(){for(var e=["clientId","organizationId","applicationId"],t=0;t<e.length;++t){var s=e[t];if(null==localStorage.getItem(s)||""==localStorage.getItem(s))return void this.handleRedirect()}var i=["appId","orgId"];for(t=0;t<i.length;++t){s=i[t];if(null==localStorage.getItem(s)||""==localStorage.getItem(s))return void this.handleRedirectApp()}Date.now()/1e3-localStorage.getItem("timeout")/1e3>3600&&(localStorage.setItem("token",""),this.handleRedirect())}toastShow(e,t){switch(e){case"success":x.Am.success(t,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:x.Mi});break;case"error":x.Am.error(t,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:x.Mi});break;case"info":x.Am.info(t,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:x.Mi})}}handleRedirect(e){this.state.redirect||this.setState({redirect:!0})}async newRuleAdd(e){var t=document.getElementById("newrule");if(!t.value)return this.toastShow("error","Role Name cannot be null or empty!"),!1;var s=!0;await(0,J.Rd)(e,J.fq.AddUpdateRules).then((function(e){s=e.success,ue=1==e.success?"Role Rule Created!":e.message}),(e=>{401==e.status?this.handleRedirect():(s=!1,ue=e.message)}));var i=s?"success":"error";return this.toastShow(i,ue),t.value="",!0}async deleteRole(e){var t=!1,s="";await(0,J.Rd)(e,J.fq.DeleteRule).then((function(e){t=e.success,s=1==e.success?"Role Deleted":e.message}),(e=>{401==e.status?this.handleRedirect():(t=!1,s=e.message)}));var i=t?"success":"error";return this.toastShow(i,s),!!t}async addUpdateRule(e){console.log(e);var t="",s=!0;await(0,J.Rd)(e,J.fq.AddUpdateRules).then((function(e){s=e.success,t=1==e.success?"Saved!":e.message}),(e=>{401==e.status?this.handleRedirect():(s=!1,t=e.message)}));var i=s?"success":"error";this.toastShow(i,t)}async getRules(e){var t=[];return await(0,J.Rd)(e,J.fq.GetRules).then((function(e){e.length>0&&e[0].hasOwnProperty("roleRules")&&(t=e)}),(e=>{401==e.status?this.handleRedirect():(!1,ue=e.message)})),t}render(){const{redirect:e}=this.state,{sendApp:t}=this.state;return e?(0,r.jsx)(l.l_,{to:"/login"}):t?(0,r.jsx)(l.l_,{to:"/applications"}):(0,r.jsxs)(o.KB,{className:"p-5",children:[(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]}),(0,r.jsx)(x.Ix,{}),(0,r.jsxs)(o.rb,{children:[(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.n2,{className:"flex-column",role:"tablist",style:pe,children:this.state.permissionItems.map(((e,t)=>(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:this.state.activeKey===t+1?me:pe,active:this.state.activeKey===t+1,onClick:this.setActiveKey.bind(this,t+1),children:e})})))})}),(0,r.jsx)(o.b7,{className:"col-10 justify-content-center",children:(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"home-tab",visible:1===this.state.activeKey,children:1===this.state.activeKey&&(0,r.jsx)(b,{service:"dataservice",handleRedirect:this.handleRedirect,toastShow:this.toastShow,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,method:"/dataservice/add/collection",setData:this.setData,position:1})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"profile-tab",visible:2===this.state.activeKey,children:2===this.state.activeKey&&(0,r.jsx)(I,{service:"dataservice",handleRedirect:this.handleRedirect,toastShow:this.toastShow,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,method:"/dataservice/update/collection",setData:this.setData,position:2})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:3===this.state.activeKey,children:3===this.state.activeKey&&(0,r.jsx)(q,{service:"dataservice",handleRedirect:this.handleRedirect,toastShow:this.toastShow,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,method:"/dataservice/delete/collection",setData:this.setData,position:3})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:4===this.state.activeKey,children:4===this.state.activeKey&&(0,r.jsx)(R,{handleRedirect:this.handleRedirect,toastShow:this.toastShow,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,setData:this.setData,position:4})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:5===this.state.activeKey,children:5===this.state.activeKey&&(0,r.jsx)(M,{handleRedirect:this.handleRedirect,toastShow:this.toastShow,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,setData:this.setData,position:5})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:6===this.state.activeKey,children:6===this.state.activeKey&&(0,r.jsx)(le,{handleRedirect:this.handleRedirect,toastShow:this.toastShow,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,setData:this.setData,position:6,data:this.state.lists[5]})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:7===this.state.activeKey,children:7===this.state.activeKey&&(0,r.jsx)(de,{handleRedirect:this.handleRedirect,toastShow:this.toastShow,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,setData:this.setData,position:7})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:8===this.state.activeKey,children:8===this.state.activeKey&&(0,r.jsx)(G,{handleRedirect:this.handleRedirect,toastShow:this.toastShow,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,setData:this.setData,position:8})})]})})]})]})}}const xe=be},6898:(e,t,s)=>{s(2791),s(184)},2439:(e,t,s)=>{s.d(t,{q:()=>i});const i=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"]}}]);
//# sourceMappingURL=887.a1e6fc19.chunk.js.map