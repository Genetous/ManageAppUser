"use strict";(self.webpackChunkgenetous_manage_apps=self.webpackChunkgenetous_manage_apps||[]).push([[39],{3628:(e,t,s)=>{s.r(t),s.d(t,{Recommendation:()=>L,default:()=>X});var n=s(2791),i=s(4846),a=s(2439),l=s(577),o=(s(5462),s(8983)),r=s(184);const c={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},d={color:"#f7f2f2"},h={float:"right"},m={height:"620px","overflow-y":"scroll"},u=["not","in","eq"];class b extends n.Component{constructor(e){super(e),this.state={nodeCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var n=s.findIndex((e=>e.id===t));return s[n].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:n}=this.state;var i=n.findIndex((e=>e.id===s));return t==n[i].activeKey}componentDidMount(){this.getCreateNodeRules()}async getCreateNodeRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"recommendationService",methodContentType:"collection",methodType:"recommendationCreate"},t=this.state.nodeCreateRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({nodeCreateRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,n,l){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l),children:(0,r.jsx)(i.Z,{style:d,icon:a.q})})})}),"object"==typeof e&&Object.keys(e).map(((c,h)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,c,s,n,l,h),value:c,name:this.getValueType(e[c]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,c,s,n,l),placeholder:u.indexOf(c)<0?"value":"values with comma",value:u.indexOf(c)<0?e[c]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+c+"_"+s+"_"+n+"_"+l,onChange:this.typeChanged.bind(this,t,c,s,n,l,h),value:this.getValueType(e[c]),disabled:e[c].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,c,s,n,l),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==h&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l),children:(0,r.jsx)(i.Z,{style:d,icon:a.q})})})]}),u.indexOf(c)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[c].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,c,s,n,l)})))})]})))]})}getArrayItems(e,t,s,n,i,a){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:h,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,n,i,a,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,n,i,a,l){var o=[...this.state.nodeCreateRules],r=o[0].roleRules.permissions[s][i].nodes[n],c={};Object.keys(r.contentData[e]).map(((t,s)=>{if(a==s)if(u.indexOf(l.target.value)<0)c[l.target.value]=r.contentData[e][t];else{var n=this.getValueAsArrayByType(r.contentData[e][t],l.target.name);c[l.target.value]=n}else c[t]=r.contentData[e][t]})),r.contentData[e]=c,this.setState({nodeCreateRules:o})}typeChanged(e,t,s,n,i,a,l){var o=[...this.state.nodeCreateRules],r=o[0].roleRules.permissions[s][i].nodes[n],c={};Object.keys(r.contentData[e]).map(((s,n)=>{if(a==n)if(u.indexOf(t)<0)c[t]=this.convert(r.contentData[e][s],l.target.value);else{var i=this.convert(r.contentData[e][s],l.target.value);c[t]=i}else c[s]=r.contentData[e][s]})),r.contentData[e]=c,this.setState({nodeCreateRules:o})}removeContentDataSubKey(e,t,s,n,i){var a=[...this.state.nodeCreateRules];delete a[0].roleRules.permissions[s][i].nodes[n].contentData[e][t],this.setState({nodeCreateRules:a})}removeContentDataSubKeyArray(e,t,s,n,i,a){var l=[...this.state.nodeCreateRules],o=l[0].roleRules.permissions[s][i].nodes[n];const r=o.contentData[e][t].indexOf(a);r>-1&&o.contentData[e][t].splice(r,1),this.setState({nodeCreateRules:l})}changeContentDataSubKey(e,t,s,n,i,a){var l=document.getElementById(e+"_"+t+"_"+s+"_"+n+"_"+i),o=[...this.state.nodeCreateRules],r=o[0].roleRules.permissions[s][i].nodes[n];if(u.indexOf(t)<0)r.contentData[e][t]=a.target.value;else if(a.target.value.toString().indexOf(",")>=0){var c=this.getValueAsArrayByType(a.target.value,l.value);switch(l.value){case"string":c[0]&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0]);break;case"number":!isNaN(c[0])&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0])}a.target.value=""}else""==a.target.value.toString().trim()&&(a.target.value="");this.setState({nodeCreateRules:o})}addNewContentDataSub(e,t,s,n){for(var i=[...this.state.nodeCreateRules],a=i[0].roleRules.permissions[t][n].nodes[s],l=0;l<this.state.compare.length;++l)if(!(this.state.compare[l]in a.contentData[e])){(l>0&&a.contentData[e][this.state.compare[l-1]].length>0||0==l)&&(a.contentData[e][this.state.compare[l]]=[]);break}this.setState({nodeCreateRules:i})}removeContentDataKey(e,t,s,n){var i=[...this.state.nodeCreateRules];delete i[0].roleRules.permissions[t][n].nodes[s].contentData[e],this.setState({nodeCreateRules:i})}changeContentDataKey(e,t,s,n,i,a){var l=[...this.state.nodeCreateRules],o=l[0].roleRules.permissions[t][n].nodes[s],r={};Object.keys(o.contentData).map(((e,t)=>{i==t?r[a.target.value]=o.contentData[e]:r[e]=o.contentData[e]})),o.contentData=r,this.setState({nodeCreateRules:l})}changeCollectionName(e,t,s,n){var i=[...this.state.nodeCreateRules];i[0].roleRules.permissions[e][s].nodes[t].collectionName=n.target.value,this.setState({nodeCreateRules:i})}changeNonPermittedCollectionName(e,t,s,n){var i=[...this.state.nodeCreateRules];i[0].roleRules.permissions[e][s].nodes[t].collectionName=n.target.value,this.setState({nodeCreateRules:i})}addNewContentData(e,t,s){var n=[...this.state.nodeCreateRules];n[0].roleRules.permissions[e][s].nodes[t].contentData.newkey={},this.setState({nodeCreateRules:n})}addNewCollection(e,t){var s=[...this.state.nodeCreateRules];s[0].roleRules.permissions[e][t].nodes.push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({nodeCreateRules:s})}removeCollection(e,t,s){var n=[...this.state.nodeCreateRules];n[0].roleRules.permissions[e][s].nodes.splice(t,1),this.setState({nodeCreateRules:n})}changeCK(e,t,s,n){var i=[...this.state.nodeCreateRules],a=i[0].roleRules.permissions[e][s].nodes[t];if(n.target.value.toString().indexOf(",")>=0){var l=this.getValueAsArrayByType(n.target.value,"string");l[0]&&a.contentKeys.indexOf(l[0])<0&&a.contentKeys.push(l[0]),n.target.value=""}this.setState({nodeCreateRules:i})}removeContentKeys(e,t,s,n,i){var a=[...this.state.nodeCreateRules],l=a[0].roleRules.permissions[t][n].nodes[s];const o=l.contentKeys.indexOf(e);o>-1&&l.contentKeys.splice(o,1),this.setState({nodeCreateRules:a})}getContentKeysItems(e,t,s,n){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:h,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,n),class:"btn-close","aria-label":"Close"})]})]})}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var n=e.split(",");switch(t){case"string":s=n;break;case"number":n.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.nodeCreateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,n,i){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:n});else{if(i)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/recommendation/create",methodType:"recommendationCreate",methodContentType:"collection",service:"recommendationService",permissions:[{role:e.value,permitted:{nodes:[]},nonPermitted:{nodes:[]}}]}]};await this.props.newRuleAdd(t),this.getCreateNodeRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var t=e[0],s=e[1],n={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(n)){var i=[...this.state.nodeCreateRules];i[0].roleRules.permissions.splice(s,1),this.setState({nodeCreateRules:i})}}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Node Create"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:m,children:this.state.nodeCreateRules.length>0&&this.state.nodeCreateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:h,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:d,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:c,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:c,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:c,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Node Items"})}),(0,r.jsx)(o.sl,{children:e.permitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:h,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"permitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Collection for ",e.role]})})})})]})}),(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Node Items"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeNonPermittedCollectionName.bind(this,t,s,"nonPermitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:h,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"nonPermitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Collection for ",e.role]})})})})]})})]})]})})))})]})}}const p=b;var x=s(4889);s(6898);const j={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},y={color:"#f7f2f2"},g={float:"right"},N={height:"620px","overflow-y":"scroll"},v=["not","in","eq"];class C extends n.Component{constructor(e){super(e),this.state={nodeDeleteRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var n=s.findIndex((e=>e.id===t));return s[n].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:n}=this.state;var i=n.findIndex((e=>e.id===s));return t==n[i].activeKey}componentDidMount(){this.getDeleteNodeRules()}async getDeleteNodeRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"recommendationService",methodContentType:"collection",methodType:"recommendationDelete"},t=this.state.nodeDeleteRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({nodeDeleteRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,n,l){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l),children:(0,r.jsx)(i.Z,{style:y,icon:a.q})})})}),"object"==typeof e&&Object.keys(e).map(((c,d)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,c,s,n,l,d),value:c,name:this.getValueType(e[c]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,c,s,n,l),placeholder:v.indexOf(c)<0?"value":"values with comma",value:v.indexOf(c)<0?e[c]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+c+"_"+s+"_"+n+"_"+l,onChange:this.typeChanged.bind(this,t,c,s,n,l,d),value:this.getValueType(e[c]),disabled:e[c].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,c,s,n,l),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==d&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l),children:(0,r.jsx)(i.Z,{style:y,icon:a.q})})})]}),v.indexOf(c)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[c].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,c,s,n,l)})))})]})))]})}getArrayItems(e,t,s,n,i,a){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,n,i,a,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,n,i,a,l){var o=[...this.state.nodeDeleteRules],r=o[0].roleRules.permissions[s][i].nodes[n],c={};Object.keys(r.contentData[e]).map(((t,s)=>{if(a==s)if(v.indexOf(l.target.value)<0)c[l.target.value]=r.contentData[e][t];else{var n=this.getValueAsArrayByType(r.contentData[e][t],l.target.name);c[l.target.value]=n}else c[t]=r.contentData[e][t]})),r.contentData[e]=c,this.setState({nodeDeleteRules:o})}typeChanged(e,t,s,n,i,a,l){var o=[...this.state.nodeDeleteRules],r=o[0].roleRules.permissions[s][i].nodes[n],c={};Object.keys(r.contentData[e]).map(((s,n)=>{if(a==n)if(v.indexOf(t)<0)c[t]=this.convert(r.contentData[e][s],l.target.value);else{var i=this.convert(r.contentData[e][s],l.target.value);c[t]=i}else c[s]=r.contentData[e][s]})),r.contentData[e]=c,this.setState({nodeDeleteRules:o})}removeContentDataSubKey(e,t,s,n,i){var a=[...this.state.nodeDeleteRules];delete a[0].roleRules.permissions[s][i].nodes[n].contentData[e][t],this.setState({nodeDeleteRules:a})}removeContentDataSubKeyArray(e,t,s,n,i,a){var l=[...this.state.nodeDeleteRules],o=l[0].roleRules.permissions[s][i].nodes[n];const r=o.contentData[e][t].indexOf(a);r>-1&&o.contentData[e][t].splice(r,1),this.setState({nodeDeleteRules:l})}changeContentDataSubKey(e,t,s,n,i,a){var l=document.getElementById(e+"_"+t+"_"+s+"_"+n+"_"+i),o=[...this.state.nodeDeleteRules],r=o[0].roleRules.permissions[s][i].nodes[n];if(v.indexOf(t)<0)r.contentData[e][t]=a.target.value;else if(a.target.value.toString().indexOf(",")>=0){var c=this.getValueAsArrayByType(a.target.value,l.value);switch(l.value){case"string":c[0]&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0]);break;case"number":!isNaN(c[0])&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0])}a.target.value=""}else""==a.target.value.toString().trim()&&(a.target.value="");this.setState({nodeDeleteRules:o})}addNewContentDataSub(e,t,s,n){for(var i=[...this.state.nodeDeleteRules],a=i[0].roleRules.permissions[t][n].nodes[s],l=0;l<this.state.compare.length;++l)if(!(this.state.compare[l]in a.contentData[e])){(l>0&&a.contentData[e][this.state.compare[l-1]].length>0||0==l)&&(a.contentData[e][this.state.compare[l]]=[]);break}this.setState({nodeDeleteRules:i})}removeContentDataKey(e,t,s,n){var i=[...this.state.nodeDeleteRules];delete i[0].roleRules.permissions[t][n].nodes[s].contentData[e],this.setState({nodeDeleteRules:i})}changeContentDataKey(e,t,s,n,i,a){var l=[...this.state.nodeDeleteRules],o=l[0].roleRules.permissions[t][n].nodes[s],r={};Object.keys(o.contentData).map(((e,t)=>{i==t?r[a.target.value]=o.contentData[e]:r[e]=o.contentData[e]})),o.contentData=r,this.setState({nodeDeleteRules:l})}changeCollectionName(e,t,s,n){var i=[...this.state.nodeDeleteRules];i[0].roleRules.permissions[e][s].nodes[t].collectionName=n.target.value,this.setState({nodeDeleteRules:i})}changeNonPermittedCollectionName(e,t,s,n){var i=[...this.state.nodeDeleteRules];i[0].roleRules.permissions[e][s].nodes[t].collectionName=n.target.value,this.setState({nodeDeleteRules:i})}addNewContentData(e,t,s){var n=[...this.state.nodeDeleteRules];n[0].roleRules.permissions[e][s].nodes[t].contentData.newkey={},this.setState({nodeDeleteRules:n})}addNewCollection(e,t){var s=[...this.state.nodeDeleteRules];s[0].roleRules.permissions[e][t].nodes.push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({nodeDeleteRules:s})}removeCollection(e,t,s){var n=[...this.state.nodeDeleteRules];n[0].roleRules.permissions[e][s].nodes.splice(t,1),this.setState({nodeDeleteRules:n})}changeCK(e,t,s,n){var i=[...this.state.nodeDeleteRules],a=i[0].roleRules.permissions[e][s].nodes[t];if(n.target.value.toString().indexOf(",")>=0){var l=this.getValueAsArrayByType(n.target.value,"string");l[0]&&a.contentKeys.indexOf(l[0])<0&&a.contentKeys.push(l[0]),n.target.value=""}this.setState({nodeDeleteRules:i})}removeContentKeys(e,t,s,n,i){var a=[...this.state.nodeDeleteRules],l=a[0].roleRules.permissions[t][n].nodes[s];const o=l.contentKeys.indexOf(e);o>-1&&l.contentKeys.splice(o,1),this.setState({nodeDeleteRules:a})}getContentKeysItems(e,t,s,n){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,n),class:"btn-close","aria-label":"Close"})]})]})}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var n=e.split(",");switch(t){case"string":s=n;break;case"number":n.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.nodeDeleteRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,n,i){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:n});else{if(i)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/recommendation/delete/nodes",methodType:"recommendationDelete",methodContentType:"collection",service:"recommendationService",permissions:[{role:e.value,permitted:{nodes:[]},nonPermitted:{nodes:[]}}]}]};await this.props.newRuleAdd(t),this.getDeleteNodeRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var t=e[0],s=e[1],n={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(n)){var i=[...this.state.nodeDeleteRules];i[0].roleRules.permissions.splice(s,1),this.setState({nodeDeleteRules:i})}}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Node Delete"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:N,children:this.state.nodeDeleteRules.length>0&&this.state.nodeDeleteRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:g,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:y,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:j,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:j,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:j,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Node Items"})}),(0,r.jsx)(o.sl,{children:e.permitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"permitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Collection for ",e.role]})})})})]})}),(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Node Items"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeNonPermittedCollectionName.bind(this,t,s,"nonPermitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:g,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"nonPermitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Collection for ",e.role]})})})})]})})]})]})})))})]})}}const R=C,f={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},D={color:"#f7f2f2"},S={float:"right"},K={height:"620px","overflow-y":"scroll"},w=["not","in","eq"];class A extends n.Component{constructor(e){super(e),this.state={nodeRelateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var n=s.findIndex((e=>e.id===t));return s[n].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:n}=this.state;var i=n.findIndex((e=>e.id===s));return t==n[i].activeKey}componentDidMount(){this.getRelateNodeRules()}async getRelateNodeRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"recommendationService",methodContentType:"relation",methodType:"recommendationCreate"},t=this.state.nodeRelateRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({nodeRelateRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,n,l,c){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l,c),children:(0,r.jsx)(i.Z,{style:D,icon:a.q})})})}),"object"==typeof e&&Object.keys(e).map(((d,h)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,d,s,n,l,h,c),value:d,name:this.getValueType(e[d]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,d,s,n,l,c),placeholder:w.indexOf(d)<0?"value":"values with comma",value:w.indexOf(d)<0?e[d]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+d+"_"+s+"_"+n+"_"+l,onChange:this.typeChanged.bind(this,t,d,s,n,l,h,c),value:this.getValueType(e[d]),disabled:e[d].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,d,s,n,l,c),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==h&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l,c),children:(0,r.jsx)(i.Z,{style:D,icon:a.q})})})]}),w.indexOf(d)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[d].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,d,s,n,l,c)})))})]})))]})}getArrayItems(e,t,s,n,i,a,l){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,n,i,a,e,l),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,n,i,a,l,o){var r=[...this.state.nodeRelateRules],c=r[0].roleRules.permissions[s][i][l][n],d={};Object.keys(c.contentData[e]).map(((t,s)=>{if(a==s)if(w.indexOf(o.target.value)<0)d[o.target.value]=c.contentData[e][t];else{var n=this.getValueAsArrayByType(c.contentData[e][t],o.target.name);d[o.target.value]=n}else d[t]=c.contentData[e][t]})),c.contentData[e]=d,this.setState({nodeRelateRules:r})}typeChanged(e,t,s,n,i,a,l,o){var r=[...this.state.nodeRelateRules],c=r[0].roleRules.permissions[s][i][l][n],d={};Object.keys(c.contentData[e]).map(((s,n)=>{if(a==n)if(w.indexOf(t)<0)d[t]=this.convert(c.contentData[e][s],o.target.value);else{var i=this.convert(c.contentData[e][s],o.target.value);d[t]=i}else d[s]=c.contentData[e][s]})),c.contentData[e]=d,this.setState({nodeRelateRules:r})}removeContentDataSubKey(e,t,s,n,i,a){var l=[...this.state.nodeRelateRules];delete l[0].roleRules.permissions[s][i][a][n].contentData[e][t],this.setState({nodeRelateRules:l})}removeContentDataSubKeyArray(e,t,s,n,i,a,l){var o=[...this.state.nodeRelateRules],r=o[0].roleRules.permissions[s][i][l][n];const c=r.contentData[e][t].indexOf(a);c>-1&&r.contentData[e][t].splice(c,1),this.setState({nodeRelateRules:o})}changeContentDataSubKey(e,t,s,n,i,a,l){var o=document.getElementById(e+"_"+t+"_"+s+"_"+n+"_"+i),r=[...this.state.nodeRelateRules],c=r[0].roleRules.permissions[s][i][a][n];if(w.indexOf(t)<0)c.contentData[e][t]=l.target.value;else if(l.target.value.toString().indexOf(",")>=0){var d=this.getValueAsArrayByType(l.target.value,o.value);switch(o.value){case"string":d[0]&&c.contentData[e][t].indexOf(d[0])<0&&c.contentData[e][t].push(d[0]);break;case"number":!isNaN(d[0])&&c.contentData[e][t].indexOf(d[0])<0&&c.contentData[e][t].push(d[0])}l.target.value=""}else""==l.target.value.toString().trim()&&(l.target.value="");this.setState({nodeRelateRules:r})}addNewContentDataSub(e,t,s,n,i){for(var a=[...this.state.nodeRelateRules],l=a[0].roleRules.permissions[t][n][i][s],o=0;o<this.state.compare.length;++o)if(!(this.state.compare[o]in l.contentData[e])){(o>0&&l.contentData[e][this.state.compare[o-1]].length>0||0==o)&&(l.contentData[e][this.state.compare[o]]=[]);break}this.setState({nodeRelateRules:a})}removeContentDataKey(e,t,s,n,i){var a=[...this.state.nodeRelateRules];delete a[0].roleRules.permissions[t][n][i][s].contentData[e],this.setState({nodeRelateRules:a})}changeContentDataKey(e,t,s,n,i,a,l){var o=[...this.state.nodeRelateRules],r=o[0].roleRules.permissions[t][n][a][s],c={};Object.keys(r.contentData).map(((e,t)=>{i==t?c[l.target.value]=r.contentData[e]:c[e]=r.contentData[e]})),r.contentData=c,this.setState({nodeRelateRules:o})}changeCollectionName(e,t,s,n,i){var a=[...this.state.nodeRelateRules];a[0].roleRules.permissions[e][s][n][t].collectionName=i.target.value,this.setState({nodeRelateRules:a})}changeNonPermittedCollectionName(e,t,s,n,i){var a=[...this.state.nodeRelateRules];a[0].roleRules.permissions[e][s][n][t].collectionName=i.target.value,this.setState({nodeRelateRules:a})}addNewContentData(e,t,s,n){var i=[...this.state.nodeRelateRules];i[0].roleRules.permissions[e][s][n][t].contentData.newkey={},this.setState({nodeRelateRules:i})}addNewCollection(e,t,s){var n=[...this.state.nodeRelateRules];n[0].roleRules.permissions[e][t][s].push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({nodeRelateRules:n})}removeCollection(e,t,s,n){var i=[...this.state.nodeRelateRules];i[0].roleRules.permissions[e][s][n].splice(t,1),this.setState({nodeRelateRules:i})}changeCK(e,t,s,n,i){var a=[...this.state.nodeRelateRules],l=a[0].roleRules.permissions[e][s][n][t];if(i.target.value.toString().indexOf(",")>=0){var o=this.getValueAsArrayByType(i.target.value,"string");o[0]&&l.contentKeys.indexOf(o[0])<0&&l.contentKeys.push(o[0]),i.target.value=""}this.setState({nodeRelateRules:a})}removeContentKeys(e,t,s,n,i,a){var l=[...this.state.nodeRelateRules],o=l[0].roleRules.permissions[t][n][i][s];const r=o.contentKeys.indexOf(e);r>-1&&o.contentKeys.splice(r,1),this.setState({nodeRelateRules:l})}changeRS(e,t,s){var n=[...this.state.nodeRelateRules],i=n[0].roleRules.permissions[e][t];if(s.target.value.toString().indexOf(",")>=0){var a=this.getValueAsArrayByType(s.target.value,"string");a[0]&&i.relationship.indexOf(a[0])<0&&i.relationship.push(a[0]),s.target.value=""}this.setState({nodeRelateRules:n})}removeRelationship(e,t,s,n){var i=[...this.state.nodeRelateRules],a=i[0].roleRules.permissions[t][s];const l=a.relationship.indexOf(e);l>-1&&a.relationship.splice(l,1),this.setState({nodeRelateRules:i})}getContentKeysItems(e,t,s,n,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,n,i),class:"btn-close","aria-label":"Close"})]})]})}getRelationshipItems(e,t,s){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeRelationship.bind(this,e,t,s),class:"btn-close","aria-label":"Close"})]})]})}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var n=e.split(",");switch(t){case"string":s=n;break;case"number":n.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.nodeRelateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,n,i){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:n});else{if(i)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/recommendation/relate",methodType:"recommendationCreate",methodContentType:"relation",service:"recommendationService",permissions:[{role:e.value,permitted:{relationship:[],nodes:[],mainNodes:[],mainSub:[]},nonPermitted:{relationship:[],nodes:[],mainNodes:[],mainSub:[]}}]}]};await this.props.newRuleAdd(t),this.getRelateNodeRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var t=e[0],s=e[1],n={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(n)){var i=[...this.state.nodeRelateRules];i[0].roleRules.permissions.splice(s,1),this.setState({nodeRelateRules:i})}}addNewMainSub(e,t){var s=[...this.state.nodeRelateRules];s[0].roleRules.permissions[e][t].mainSub.push({main:"mainCollectionName",sub:[]}),this.setState({nodeRelateRules:s})}removeMainSub(e,t,s){var n=[...this.state.nodeRelateRules];n[0].roleRules.permissions[e][s].mainSub.splice(t,1),this.setState({nodeRelateRules:n})}mainCollectionChange(e,t,s,n){var i=[...this.state.nodeRelateRules];i[0].roleRules.permissions[e][s].mainSub[t].main=n.target.value,this.setState({nodeRelateRules:i})}changeSub(e,t,s,n){var i=[...this.state.nodeRelateRules],a=i[0].roleRules.permissions[e][s].mainSub[t];if(n.target.value.toString().indexOf(",")>=0){var l=this.getValueAsArrayByType(n.target.value,"string");l[0]&&a.sub.indexOf(l[0])<0&&a.sub.push(l[0]),n.target.value=""}this.setState({nodeRelateRules:i})}getMainSubItems(e,t,s,n,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeSub.bind(this,t,s,n,i),class:"btn-close","aria-label":"Close"})]})]})}removeSub(e,t,s,n,i){var a=[...this.state.nodeRelateRules];a[0].roleRules.permissions[e][n].mainSub[t].sub.splice(s,1),this.setState({nodeRelateRules:a})}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Node Relate"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:K,children:this.state.nodeRelateRules.length>0&&this.state.nodeRelateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:S,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:D,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:f,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:f,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:f,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:[(0,r.jsxs)(o.xH,{children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Relationship Items"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"relationship",onChange:this.changeRS.bind(this,t,"permitted"),placeholder:"Relationship"})})}),(0,r.jsx)(o.rb,{children:e.permitted.relationship.map(((e,s)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getRelationshipItems(e,t,"permitted")})))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Child Node Items"})}),(0,r.jsx)(o.sl,{children:e.permitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted","nodes"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted","nodes"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"permitted",i,"nodes")})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"permitted","nodes"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"permitted","nodes")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted","nodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted","nodes"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted","nodes")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 d-flex justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted","nodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Child Node for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main Node Items"})}),(0,r.jsx)(o.sl,{children:e.permitted.mainNodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted","mainNodes"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted","mainNodes"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"permitted",i,"mainNodes")})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"permitted","mainNodes"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"permitted","mainNodes")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted","mainNodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted","mainNodes"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted","mainNodes")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 d-flex justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted","mainNodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Main Node for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main - Child Node Relation Permissions"})}),(0,r.jsx)(o.sl,{children:e.permitted.mainSub.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"main",placeholder:"Main Collection Name",onChange:this.mainCollectionChange.bind(this,t,s,"permitted"),value:e.main})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeMainSub.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"subCollection",onChange:this.changeSub.bind(this,t,s,"permitted"),placeholder:"Child Collection Names with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.sub.map(((e,n)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getMainSubItems(e,t,s,n,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewMainSub.bind(this,t,"permitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add Main - Child Relation for ",e.role]})})})})]})]}),(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:[(0,r.jsxs)(o.xH,{children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Relationship Items"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"relationship",onChange:this.changeRS.bind(this,t,"nonPermitted"),placeholder:"Relationship"})})}),(0,r.jsx)(o.rb,{children:e.nonPermitted.relationship.map(((e,s)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getRelationshipItems(e,t,"nonPermitted")})))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Child Node Items"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"nonPermitted","nodes"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted","nodes"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"nonPermitted",i,"nodes")})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"nonPermitted","nodes"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"nonPermitted","nodes")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted","nodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted","nodes"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted","nodes")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 d-flex justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted","nodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Child Node for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main Node Items"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.mainNodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"nonPermitted","mainNodes"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted","mainNodes"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"nonPermitted",i,"mainNodes")})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"nonPermitted","mainNodes"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"nonPermitted","mainNodes")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted","mainNodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted","mainNodes"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted","mainNodes")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 d-flex justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted","mainNodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Main Node for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main - Child Node Relation Permissions"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.mainSub.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"main",placeholder:"Main Collection Name",onChange:this.mainCollectionChange.bind(this,t,s,"nonPermitted"),value:e.main})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:S,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeMainSub.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"subCollection",onChange:this.changeSub.bind(this,t,s,"nonPermitted"),placeholder:"Child Collection Names with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.sub.map(((e,n)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getMainSubItems(e,t,s,n,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewMainSub.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add Main - Child Relation for ",e.role]})})})})]})]})]})]})})))})]})}}const I=A,k={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},O={color:"#f7f2f2"},P={float:"right"},V={height:"620px","overflow-y":"scroll"},T=["not","in","eq"];class U extends n.Component{constructor(e){super(e),this.state={nodeDeleteRelationRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var n=s.findIndex((e=>e.id===t));return s[n].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:n}=this.state;var i=n.findIndex((e=>e.id===s));return t==n[i].activeKey}componentDidMount(){this.getDeleteRelationNodeRules()}async getDeleteRelationNodeRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"recommendationService",methodContentType:"relation",methodType:"recommendationDelete"},t=this.state.nodeDeleteRelationRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({nodeDeleteRelationRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,n,l,c){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l,c),children:(0,r.jsx)(i.Z,{style:O,icon:a.q})})})}),"object"==typeof e&&Object.keys(e).map(((d,h)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,d,s,n,l,h,c),value:d,name:this.getValueType(e[d]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,d,s,n,l,c),placeholder:T.indexOf(d)<0?"value":"values with comma",value:T.indexOf(d)<0?e[d]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+d+"_"+s+"_"+n+"_"+l,onChange:this.typeChanged.bind(this,t,d,s,n,l,h,c),value:this.getValueType(e[d]),disabled:e[d].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,d,s,n,l,c),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==h&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l,c),children:(0,r.jsx)(i.Z,{style:O,icon:a.q})})})]}),T.indexOf(d)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[d].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,d,s,n,l,c)})))})]})))]})}getArrayItems(e,t,s,n,i,a,l){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,n,i,a,e,l),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,n,i,a,l,o){var r=[...this.state.nodeDeleteRelationRules],c=r[0].roleRules.permissions[s][i][l][n],d={};Object.keys(c.contentData[e]).map(((t,s)=>{if(a==s)if(T.indexOf(o.target.value)<0)d[o.target.value]=c.contentData[e][t];else{var n=this.getValueAsArrayByType(c.contentData[e][t],o.target.name);d[o.target.value]=n}else d[t]=c.contentData[e][t]})),c.contentData[e]=d,this.setState({nodeDeleteRelationRules:r})}typeChanged(e,t,s,n,i,a,l,o){var r=[...this.state.nodeDeleteRelationRules],c=r[0].roleRules.permissions[s][i][l][n],d={};Object.keys(c.contentData[e]).map(((s,n)=>{if(a==n)if(T.indexOf(t)<0)d[t]=this.convert(c.contentData[e][s],o.target.value);else{var i=this.convert(c.contentData[e][s],o.target.value);d[t]=i}else d[s]=c.contentData[e][s]})),c.contentData[e]=d,this.setState({nodeDeleteRelationRules:r})}removeContentDataSubKey(e,t,s,n,i,a){var l=[...this.state.nodeDeleteRelationRules];delete l[0].roleRules.permissions[s][i][a][n].contentData[e][t],this.setState({nodeDeleteRelationRules:l})}removeContentDataSubKeyArray(e,t,s,n,i,a,l){var o=[...this.state.nodeDeleteRelationRules],r=o[0].roleRules.permissions[s][i][l][n];const c=r.contentData[e][t].indexOf(a);c>-1&&r.contentData[e][t].splice(c,1),this.setState({nodeDeleteRelationRules:o})}changeContentDataSubKey(e,t,s,n,i,a,l){var o=document.getElementById(e+"_"+t+"_"+s+"_"+n+"_"+i),r=[...this.state.nodeDeleteRelationRules],c=r[0].roleRules.permissions[s][i][a][n];if(T.indexOf(t)<0)c.contentData[e][t]=l.target.value;else if(l.target.value.toString().indexOf(",")>=0){var d=this.getValueAsArrayByType(l.target.value,o.value);switch(o.value){case"string":d[0]&&c.contentData[e][t].indexOf(d[0])<0&&c.contentData[e][t].push(d[0]);break;case"number":!isNaN(d[0])&&c.contentData[e][t].indexOf(d[0])<0&&c.contentData[e][t].push(d[0])}l.target.value=""}else""==l.target.value.toString().trim()&&(l.target.value="");this.setState({nodeDeleteRelationRules:r})}addNewContentDataSub(e,t,s,n,i){for(var a=[...this.state.nodeDeleteRelationRules],l=a[0].roleRules.permissions[t][n][i][s],o=0;o<this.state.compare.length;++o)if(!(this.state.compare[o]in l.contentData[e])){(o>0&&l.contentData[e][this.state.compare[o-1]].length>0||0==o)&&(l.contentData[e][this.state.compare[o]]=[]);break}this.setState({nodeDeleteRelationRules:a})}removeContentDataKey(e,t,s,n,i){var a=[...this.state.nodeDeleteRelationRules];delete a[0].roleRules.permissions[t][n][i][s].contentData[e],this.setState({nodeDeleteRelationRules:a})}changeContentDataKey(e,t,s,n,i,a,l){var o=[...this.state.nodeDeleteRelationRules],r=o[0].roleRules.permissions[t][n][a][s],c={};Object.keys(r.contentData).map(((e,t)=>{i==t?c[l.target.value]=r.contentData[e]:c[e]=r.contentData[e]})),r.contentData=c,this.setState({nodeDeleteRelationRules:o})}changeCollectionName(e,t,s,n,i){var a=[...this.state.nodeDeleteRelationRules];a[0].roleRules.permissions[e][s][n][t].collectionName=i.target.value,this.setState({nodeDeleteRelationRules:a})}changeNonPermittedCollectionName(e,t,s,n,i){var a=[...this.state.nodeDeleteRelationRules];a[0].roleRules.permissions[e][s][n][t].collectionName=i.target.value,this.setState({nodeDeleteRelationRules:a})}addNewContentData(e,t,s,n){var i=[...this.state.nodeDeleteRelationRules];i[0].roleRules.permissions[e][s][n][t].contentData.newkey={},this.setState({nodeDeleteRelationRules:i})}addNewCollection(e,t,s){var n=[...this.state.nodeDeleteRelationRules];n[0].roleRules.permissions[e][t][s].push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({nodeDeleteRelationRules:n})}removeCollection(e,t,s,n){var i=[...this.state.nodeDeleteRelationRules];i[0].roleRules.permissions[e][s][n].splice(t,1),this.setState({nodeDeleteRelationRules:i})}changeCK(e,t,s,n,i){var a=[...this.state.nodeDeleteRelationRules],l=a[0].roleRules.permissions[e][s][n][t];if(i.target.value.toString().indexOf(",")>=0){var o=this.getValueAsArrayByType(i.target.value,"string");o[0]&&l.contentKeys.indexOf(o[0])<0&&l.contentKeys.push(o[0]),i.target.value=""}this.setState({nodeDeleteRelationRules:a})}removeContentKeys(e,t,s,n,i,a){var l=[...this.state.nodeDeleteRelationRules],o=l[0].roleRules.permissions[t][n][i][s];const r=o.contentKeys.indexOf(e);r>-1&&o.contentKeys.splice(r,1),this.setState({nodeDeleteRelationRules:l})}changeRS(e,t,s){var n=[...this.state.nodeDeleteRelationRules],i=n[0].roleRules.permissions[e][t];if(s.target.value.toString().indexOf(",")>=0){var a=this.getValueAsArrayByType(s.target.value,"string");a[0]&&i.relationship.indexOf(a[0])<0&&i.relationship.push(a[0]),s.target.value=""}this.setState({nodeDeleteRelationRules:n})}removeRelationship(e,t,s,n){var i=[...this.state.nodeDeleteRelationRules],a=i[0].roleRules.permissions[t][s];const l=a.relationship.indexOf(e);l>-1&&a.relationship.splice(l,1),this.setState({nodeDeleteRelationRules:i})}getContentKeysItems(e,t,s,n,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,n,i),class:"btn-close","aria-label":"Close"})]})]})}getRelationshipItems(e,t,s){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeRelationship.bind(this,e,t,s),class:"btn-close","aria-label":"Close"})]})]})}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var n=e.split(",");switch(t){case"string":s=n;break;case"number":n.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.nodeDeleteRelationRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,n,i){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:n});else{if(i)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/recommendation/delete/relation",methodType:"recommendationDelete",methodContentType:"relation",service:"recommendationService",permissions:[{role:e.value,permitted:{relationship:[],nodes:[],mainNodes:[],mainSub:[]},nonPermitted:{relationship:[],nodes:[],mainNodes:[],mainSub:[]}}]}]};await this.props.newRuleAdd(t),this.getDeleteRelationNodeRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var t=e[0],s=e[1],n={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(n)){var i=[...this.state.nodeDeleteRelationRules];i[0].roleRules.permissions.splice(s,1),this.setState({nodeDeleteRelationRules:i})}}addNewMainSub(e,t){var s=[...this.state.nodeDeleteRelationRules];s[0].roleRules.permissions[e][t].mainSub.push({main:"mainCollectionName",sub:[]}),this.setState({nodeDeleteRelationRules:s})}removeMainSub(e,t,s){var n=[...this.state.nodeDeleteRelationRules];n[0].roleRules.permissions[e][s].mainSub.splice(t,1),this.setState({nodeDeleteRelationRules:n})}mainCollectionChange(e,t,s,n){var i=[...this.state.nodeDeleteRelationRules];i[0].roleRules.permissions[e][s].mainSub[t].main=n.target.value,this.setState({nodeDeleteRelationRules:i})}changeSub(e,t,s,n){var i=[...this.state.nodeDeleteRelationRules],a=i[0].roleRules.permissions[e][s].mainSub[t];if(n.target.value.toString().indexOf(",")>=0){var l=this.getValueAsArrayByType(n.target.value,"string");l[0]&&a.sub.indexOf(l[0])<0&&a.sub.push(l[0]),n.target.value=""}this.setState({nodeDeleteRelationRules:i})}getMainSubItems(e,t,s,n,i){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeSub.bind(this,t,s,n,i),class:"btn-close","aria-label":"Close"})]})]})}removeSub(e,t,s,n,i){var a=[...this.state.nodeDeleteRelationRules];a[0].roleRules.permissions[e][n].mainSub[t].sub.splice(s,1),this.setState({nodeDeleteRelationRules:a})}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Node Delete Relation"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:V,children:this.state.nodeDeleteRelationRules.length>0&&this.state.nodeDeleteRelationRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:P,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:O,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:k,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:k,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:k,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:[(0,r.jsxs)(o.xH,{children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Relationship Items"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"relationship",onChange:this.changeRS.bind(this,t,"permitted"),placeholder:"Relationship"})})}),(0,r.jsx)(o.rb,{children:e.permitted.relationship.map(((e,s)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getRelationshipItems(e,t,"permitted")})))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Child Node Items"})}),(0,r.jsx)(o.sl,{children:e.permitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted","nodes"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted","nodes"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"permitted",i,"nodes")})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"permitted","nodes"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"permitted","nodes")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted","nodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted","nodes"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted","nodes")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 d-flex justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted","nodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Child Node for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main Node Items"})}),(0,r.jsx)(o.sl,{children:e.permitted.mainNodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted","mainNodes"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted","mainNodes"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"permitted",i,"mainNodes")})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"permitted","mainNodes"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"permitted","mainNodes")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted","mainNodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted","mainNodes"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted","mainNodes")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 d-flex justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted","mainNodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Main Node for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main - Child Node Relation Permissions"})}),(0,r.jsx)(o.sl,{children:e.permitted.mainSub.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"main",placeholder:"Main Collection Name",onChange:this.mainCollectionChange.bind(this,t,s,"permitted"),value:e.main})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeMainSub.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"subCollection",onChange:this.changeSub.bind(this,t,s,"permitted"),placeholder:"Child Collection Names with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.sub.map(((e,n)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getMainSubItems(e,t,s,n,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewMainSub.bind(this,t,"permitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add Main - Child Relation for ",e.role]})})})})]})]}),(0,r.jsxs)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:[(0,r.jsxs)(o.xH,{children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Relationship Items"})}),(0,r.jsxs)(o.sl,{children:[(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"relationship",onChange:this.changeRS.bind(this,t,"nonPermitted"),placeholder:"Relationship"})})}),(0,r.jsx)(o.rb,{children:e.nonPermitted.relationship.map(((e,s)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getRelationshipItems(e,t,"nonPermitted")})))})]})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Child Node Items"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"nonPermitted","nodes"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted","nodes"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"nonPermitted",i,"nodes")})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"nonPermitted","nodes"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"nonPermitted","nodes")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted","nodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted","nodes"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted","nodes")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 d-flex justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted","nodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Child Node for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main Node Items"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.mainNodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"nonPermitted","mainNodes"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted","mainNodes"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"nonPermitted",i,"mainNodes")})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"nonPermitted","mainNodes"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"nonPermitted","mainNodes")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted","mainNodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted","mainNodes"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted","mainNodes")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 d-flex justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted","mainNodes"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Main Node for ",e.role]})})})})]}),(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Main - Child Node Relation Permissions"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.mainSub.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"main",placeholder:"Main Collection Name",onChange:this.mainCollectionChange.bind(this,t,s,"nonPermitted"),value:e.main})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:P,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeMainSub.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"subCollection",onChange:this.changeSub.bind(this,t,s,"nonPermitted"),placeholder:"Child Collection Names with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.sub.map(((e,n)=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getMainSubItems(e,t,s,n,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewMainSub.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add Main - Child Relation for ",e.role]})})})})]})]})]})]})})))})]})}}const _=U,q={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},B={color:"#f7f2f2"},H={float:"right"},M={height:"620px","overflow-y":"scroll"},Y=["not","in","eq"];class Z extends n.Component{constructor(e){super(e),this.state={nodeUpdateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:"",compare:["eq","not","gt","gte","lt","lte","in"]}}setSubActiveKey(e,t){const{subKeys:s}=this.state;var n=s.findIndex((e=>e.id===t));return s[n].activeKey=e,this.setState({subKeys:s}),!1}getSubActiveKey(e,t,s){const{subKeys:n}=this.state;var i=n.findIndex((e=>e.id===s));return t==n[i].activeKey}componentDidMount(){this.getCreateNodeRules()}async getCreateNodeRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"recommendationService",methodContentType:"collection",methodType:"recommendationUpdate"},t=this.state.nodeUpdateRules;t=await this.props.getRules(e);var s=[];t.length>0&&t[0].roleRules.permissions.map((e=>{var t={id:e._id,activeKey:1};s.push(t)}));this.setState({nodeUpdateRules:t,subKeys:s})}getValueType(e){return Array.isArray(e)&&e.length>0?typeof e[0]:typeof e}getContentData(e,t,s,n,l){return(0,r.jsxs)("div",{children:[Object.keys(e).length<1&&(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l),children:(0,r.jsx)(i.Z,{style:B,icon:a.q})})})}),"object"==typeof e&&Object.keys(e).map(((c,d)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{onChange:this.eqChanged.bind(this,t,c,s,n,l,d),value:c,name:this.getValueType(e[c]),children:[(0,r.jsx)("option",{value:"eq",children:"="}),(0,r.jsx)("option",{value:"not",children:"!="}),(0,r.jsx)("option",{value:"gt",children:">"}),(0,r.jsx)("option",{value:"gte",children:">="}),(0,r.jsx)("option",{value:"lt",children:"<"}),(0,r.jsx)("option",{value:"lte",children:"<="}),(0,r.jsx)("option",{value:"in",children:"in"})]})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsx)(o.jO,{type:"text",name:"value",onChange:this.changeContentDataSubKey.bind(this,t,c,s,n,l),placeholder:Y.indexOf(c)<0?"value":"values with comma",value:Y.indexOf(c)<0?e[c]:this.value})}),(0,r.jsx)(o.b7,{className:"col-3",children:(0,r.jsxs)(o.LX,{id:t+"_"+c+"_"+s+"_"+n+"_"+l,onChange:this.typeChanged.bind(this,t,c,s,n,l,d),value:this.getValueType(e[c]),disabled:e[c].length<1,children:[(0,r.jsx)("option",{value:"string",children:"String"}),(0,r.jsx)("option",{value:"number",children:"Integer"})]})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKey.bind(this,t,c,s,n,l),class:"btn-close","aria-label":"Remove"})}),Object.keys(e).length-1==d&&(0,r.jsx)(o.b7,{className:"col-1",children:(0,r.jsx)(o.u5,{color:"primary",onClick:this.addNewContentDataSub.bind(this,t,s,n,l),children:(0,r.jsx)(i.Z,{style:B,icon:a.q})})})]}),Y.indexOf(c)>=0&&(0,r.jsx)(o.rb,{className:"mt-2",children:e[c].map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getArrayItems(e,t,c,s,n,l)})))})]})))]})}getArrayItems(e,t,s,n,i,a){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:H,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataSubKeyArray.bind(this,t,s,n,i,a,e),class:"btn-close","aria-label":"Close"})]})]})}eqChanged(e,t,s,n,i,a,l){var o=[...this.state.nodeUpdateRules],r=o[0].roleRules.permissions[s][i].nodes[n],c={};Object.keys(r.contentData[e]).map(((t,s)=>{if(a==s)if(Y.indexOf(l.target.value)<0)c[l.target.value]=r.contentData[e][t];else{var n=this.getValueAsArrayByType(r.contentData[e][t],l.target.name);c[l.target.value]=n}else c[t]=r.contentData[e][t]})),r.contentData[e]=c,this.setState({nodeUpdateRules:o})}typeChanged(e,t,s,n,i,a,l){var o=[...this.state.nodeUpdateRules],r=o[0].roleRules.permissions[s][i].nodes[n],c={};Object.keys(r.contentData[e]).map(((s,n)=>{if(a==n)if(Y.indexOf(t)<0)c[t]=this.convert(r.contentData[e][s],l.target.value);else{var i=this.convert(r.contentData[e][s],l.target.value);c[t]=i}else c[s]=r.contentData[e][s]})),r.contentData[e]=c,this.setState({nodeUpdateRules:o})}removeContentDataSubKey(e,t,s,n,i){var a=[...this.state.nodeUpdateRules];delete a[0].roleRules.permissions[s][i].nodes[n].contentData[e][t],this.setState({nodeUpdateRules:a})}removeContentDataSubKeyArray(e,t,s,n,i,a){var l=[...this.state.nodeUpdateRules],o=l[0].roleRules.permissions[s][i].nodes[n];const r=o.contentData[e][t].indexOf(a);r>-1&&o.contentData[e][t].splice(r,1),this.setState({nodeUpdateRules:l})}changeContentDataSubKey(e,t,s,n,i,a){var l=document.getElementById(e+"_"+t+"_"+s+"_"+n+"_"+i),o=[...this.state.nodeUpdateRules],r=o[0].roleRules.permissions[s][i].nodes[n];if(Y.indexOf(t)<0)r.contentData[e][t]=a.target.value;else if(a.target.value.toString().indexOf(",")>=0){var c=this.getValueAsArrayByType(a.target.value,l.value);switch(l.value){case"string":c[0]&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0]);break;case"number":!isNaN(c[0])&&r.contentData[e][t].indexOf(c[0])<0&&r.contentData[e][t].push(c[0])}a.target.value=""}else""==a.target.value.toString().trim()&&(a.target.value="");this.setState({nodeUpdateRules:o})}addNewContentDataSub(e,t,s,n){for(var i=[...this.state.nodeUpdateRules],a=i[0].roleRules.permissions[t][n].nodes[s],l=0;l<this.state.compare.length;++l)if(!(this.state.compare[l]in a.contentData[e])){(l>0&&a.contentData[e][this.state.compare[l-1]].length>0||0==l)&&(a.contentData[e][this.state.compare[l]]=[]);break}this.setState({nodeUpdateRules:i})}removeContentDataKey(e,t,s,n){var i=[...this.state.nodeUpdateRules];delete i[0].roleRules.permissions[t][n].nodes[s].contentData[e],this.setState({nodeUpdateRules:i})}changeContentDataKey(e,t,s,n,i,a){var l=[...this.state.nodeUpdateRules],o=l[0].roleRules.permissions[t][n].nodes[s],r={};Object.keys(o.contentData).map(((e,t)=>{i==t?r[a.target.value]=o.contentData[e]:r[e]=o.contentData[e]})),o.contentData=r,this.setState({nodeUpdateRules:l})}changeCollectionName(e,t,s,n){var i=[...this.state.nodeUpdateRules];i[0].roleRules.permissions[e][s].nodes[t].collectionName=n.target.value,this.setState({nodeUpdateRules:i})}changeNonPermittedCollectionName(e,t,s,n){var i=[...this.state.nodeUpdateRules];i[0].roleRules.permissions[e][s].nodes[t].collectionName=n.target.value,this.setState({nodeUpdateRules:i})}addNewContentData(e,t,s){var n=[...this.state.nodeUpdateRules];n[0].roleRules.permissions[e][s].nodes[t].contentData.newkey={},this.setState({nodeUpdateRules:n})}addNewCollection(e,t){var s=[...this.state.nodeUpdateRules];s[0].roleRules.permissions[e][t].nodes.push({collectionName:"collectionName",contentData:{},contentKeys:[]}),this.setState({nodeUpdateRules:s})}removeCollection(e,t,s){var n=[...this.state.nodeUpdateRules];n[0].roleRules.permissions[e][s].nodes.splice(t,1),this.setState({nodeUpdateRules:n})}changeCK(e,t,s,n){var i=[...this.state.nodeUpdateRules],a=i[0].roleRules.permissions[e][s].nodes[t];if(n.target.value.toString().indexOf(",")>=0){var l=this.getValueAsArrayByType(n.target.value,"string");l[0]&&a.contentKeys.indexOf(l[0])<0&&a.contentKeys.push(l[0]),n.target.value=""}this.setState({nodeUpdateRules:i})}removeContentKeys(e,t,s,n,i){var a=[...this.state.nodeUpdateRules],l=a[0].roleRules.permissions[t][n].nodes[s];const o=l.contentKeys.indexOf(e);o>-1&&l.contentKeys.splice(o,1),this.setState({nodeUpdateRules:a})}getContentKeysItems(e,t,s,n){return(0,r.jsxs)("p",{className:"p-1 rounded border border-primary text-primary",children:[e,(0,r.jsxs)("span",{style:H,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeContentKeys.bind(this,e,t,s,n),class:"btn-close","aria-label":"Close"})]})]})}getValueAsArray(e){var t=[];return e.toString().indexOf(",")>=0?t=e.split(","):t.push(e),t}getValueAsArrayByType(e,t){var s=[];if(e.toString().indexOf(",")>=0){var n=e.split(",");switch(t){case"string":s=n;break;case"number":n.map((e=>{s.push(parseInt(e))}))}}else switch(t){case"string":e&&s.push(e);break;case"number":isNaN(e)||s.push(e)}return s}convert(e,t){if(Array.isArray(e))switch(t){case"string":var s=[];return e.map((e=>{s.push(e.toString())})),s;case"number":s=[];return e.map((e=>{e=parseInt(e);isNaN(e)||s.push(e)})),s}else switch(t){case"string":return e.toString();case"number":return parseInt(e)}}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.nodeUpdateRules][0].roleRules,t={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[t]};this.props.addUpdateRule(s)}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,t,s,n,i){if(e)this.setState({yesNoVisible:e,yesNoQuestion:t,sendType:s,arguments:n});else{if(i)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;var t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/recommendation/update/nodes",methodType:"recommendationUpdate",methodContentType:"collection",service:"recommendationService",permissions:[{role:e.value,permitted:{nodes:[]},nonPermitted:{nodes:[]}}]}]};await this.props.newRuleAdd(t),this.getCreateNodeRules()}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var t=e[0],s=e[1],n={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:t};if(await this.props.deleteRole(n)){var i=[...this.state.nodeUpdateRules];i[0].roleRules.permissions.splice(s,1),this.setState({nodeUpdateRules:i})}}render(){return(0,r.jsxs)(o.xH,{children:[(0,r.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,r.jsx)(o.b7,{className:"col-6 pb-2",children:(0,r.jsxs)(o.tj,{children:["Add/Update ",(0,r.jsx)("b",{children:'"Node Update"'})," Permissions"]})}),(0,r.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,r.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,r.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:"Add New Role"})}),(0,r.jsx)(o.sD,{children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,r.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,r.jsx)(o.p0,{children:(0,r.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,r.jsxs)(o.Ym,{children:[(0,r.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,r.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,r.jsx)(o.sl,{style:M,children:this.state.nodeUpdateRules.length>0&&this.state.nodeUpdateRules[0].roleRules.permissions.map(((e,t)=>(0,r.jsx)(o.xH,{className:"mt-1",children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.tj,{children:[(0,r.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,r.jsx)("span",{style:H,children:(0,r.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,t,this]),style:B,children:"Delete Role"})})]}),(0,r.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:q,children:[(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:q,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:q,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Node Items"})}),(0,r.jsx)(o.sl,{children:e.permitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeCollectionName.bind(this,t,s,"permitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:H,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"permitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"permitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"permitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"permitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"permitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"permitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"permitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"permitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Collection for ",e.role]})})})})]})}),(0,r.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:(0,r.jsxs)(o.xH,{className:"mt-2",children:[(0,r.jsx)(o.bn,{children:(0,r.jsx)(o.tj,{className:"p-2",children:"Node Items"})}),(0,r.jsx)(o.sl,{children:e.nonPermitted.nodes.map(((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)(o.rb,{className:"mt-2",children:[(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.jO,{type:"text",name:"collectionName",onChange:this.changeNonPermittedCollectionName.bind(this,t,s,"nonPermitted"),placeholder:"Collection Name",value:e.collectionName})}),(0,r.jsx)(o.b7,{className:"align-self-center",children:(0,r.jsxs)("span",{style:H,children:[" ",(0,r.jsx)("button",{type:"button",onClick:this.removeCollection.bind(this,t,s,"nonPermitted"),class:"btn-close","aria-label":"Close"})]})})]}),Object.keys(e.contentData).map(((n,i)=>(0,r.jsx)("div",{children:(0,r.jsx)(o.rb,{className:"mt-2",children:(0,r.jsx)(o.b7,{className:"col-11",children:(0,r.jsx)(o.xH,{children:(0,r.jsxs)(o.sl,{children:[(0,r.jsxs)(o.rb,{className:"mt-2 pb-2 border-bottom",children:[(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",placeholder:"Content Field",value:n,onChange:this.changeContentDataKey.bind(this,n,t,s,"nonPermitted",i)})}),(0,r.jsx)(o.b7,{className:"col-1 align-self-center",children:(0,r.jsx)("button",{type:"button",onClick:this.removeContentDataKey.bind(this,n,t,s,"nonPermitted"),class:"btn-close","aria-label":"Remove"})})]}),this.getContentData(e.contentData[n],n,t,s,"nonPermitted")]})})})})}))),(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewContentData.bind(this,t,s,"nonPermitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Content Data for ",e.collectionName]})})}),(0,r.jsx)(o.rb,{className:"mt-2 pb-2",children:(0,r.jsx)(o.b7,{className:"col-9",children:(0,r.jsx)(o.jO,{type:"text",name:"contentKeys",onChange:this.changeCK.bind(this,t,s,"nonPermitted"),placeholder:"Content Keys with comma"})})}),(0,r.jsx)(o.rb,{className:"mt-2",children:e.contentKeys.map((e=>(0,r.jsx)(o.b7,{className:"col-3",children:this.getContentKeysItems(e,t,s,"nonPermitted")})))})]})))}),(0,r.jsx)(o.Bt,{children:(0,r.jsx)(o.rb,{className:"mt-2 justify-content-center",children:(0,r.jsx)(o.b7,{className:"col-6 text-center",children:(0,r.jsxs)(o.u5,{onClick:this.addNewCollection.bind(this,t,"nonPermitted"),children:[(0,r.jsx)(i.Z,{icon:a.q}),"Add New Collection for ",e.role]})})})})]})})]})]})})))})]})}}const Q=Z;var z=s(4880);const F={cursor:"pointer",color:"rgba(33, 37, 41,0.8)","background-color":"#fff"},E={cursor:"pointer","background-color":"rgba(33, 37, 41,0.8)",color:"#fff"};class L extends n.Component{constructor(e){super(e),this.state={permissionItems:["Create Node","Update Node","Delete Node","Relate Nodes","Delete Relation"],collectionCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],redirect:!1,sendApp:!1},this.handleRedirect=this.handleRedirect.bind(this),this.newRuleAdd=this.newRuleAdd.bind(this),this.deleteRole=this.deleteRole.bind(this),this.addUpdateRule=this.addUpdateRule.bind(this),this.getRules=this.getRules.bind(this),this.toastShow=this.toastShow.bind(this)}handleRedirectApp(){this.state.sendApp||this.setState({sendApp:!0})}componentDidMount(){for(var e=["clientId","organizationId","applicationId"],t=0;t<e.length;++t){var s=e[t];if(null==localStorage.getItem(s)||""==localStorage.getItem(s))return void this.handleRedirect()}var n=["appId","orgId"];for(t=0;t<n.length;++t){s=n[t];if(null==localStorage.getItem(s)||""==localStorage.getItem(s))return void this.handleRedirectApp()}}handleRedirect(e){this.state.redirect||this.setState({redirect:!0})}setActiveKey(e){return this.setState({activeKey:e}),!1}async newRuleAdd(e){var t=document.getElementById("newrule");if(!t.value)return this.toastShow("error","Role Name cannot be null or empty!"),!1;var s=!1,n="";await(0,x.Rd)(e,x.fq.AddUpdateRules).then((function(e){s=e.success,n=1==e.success?"Role Rule Created!":e.message}),(e=>{401==e.status?this.handleRedirect():(s=!1,n=e.message)}));var i=s?"success":"error";return this.toastShow(i,n),t.value="",!0}async deleteRole(e){var t=!1,s="";await(0,x.Rd)(e,x.fq.DeleteRule).then((function(e){t=e.success,s=1==e.success?"Role Deleted":e.message}),(e=>{401==e.status?this.handleRedirect():(t=!1,s=e.message)}));var n=t?"success":"error";return this.toastShow(n,s),!!t}async addUpdateRule(e){console.log(e);var t=!0;await(0,x.Rd)(e,x.fq.AddUpdateRules).then((function(e){t=e.success,1==e.success?message="Saved!":message=e.message}),(e=>{401==e.status?this.handleRedirect():(t=!1,message=e.message)}));var s=t?"success":"error";this.toastShow(s,message)}async getRules(e){var t=[];return await(0,x.Rd)(e,x.fq.GetRules).then((function(e){e.length>0&&e[0].hasOwnProperty("roleRules")&&(t=e)}),(e=>{401==e.status?this.handleRedirect():(!1,message=e.message)})),t}toastShow(e,t){switch(e){case"success":l.Am.success(t,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:l.Mi});break;case"error":l.Am.error(t,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:l.Mi});break;case"info":l.Am.info(t,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:l.Mi})}}render(){const{redirect:e}=this.state,{sendApp:t}=this.state;return e?(0,r.jsx)(z.l_,{to:"/login"}):t?(0,r.jsx)(z.l_,{to:"/applications"}):(0,r.jsxs)(o.KB,{className:"p-5",children:[(0,r.jsx)(l.Ix,{}),(0,r.jsxs)(o.rb,{children:[(0,r.jsx)(o.b7,{className:"col-2",children:(0,r.jsx)(o.n2,{className:"flex-column",role:"tablist",style:F,children:this.state.permissionItems.map(((e,t)=>(0,r.jsx)(o.U6,{children:(0,r.jsx)(o.AQ,{style:this.state.activeKey===t+1?E:F,active:this.state.activeKey===t+1,onClick:this.setActiveKey.bind(this,t+1),children:e})})))})}),(0,r.jsx)(o.b7,{className:"col-10 justify-content-center",children:(0,r.jsxs)(o.gr,{children:[(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"home-tab",visible:1===this.state.activeKey,children:(0,r.jsx)(p,{handleRedirect:this.handleRedirect,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,toastShow:this.toastShow})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"profile-tab",visible:2===this.state.activeKey,children:(0,r.jsx)(Q,{handleRedirect:this.handleRedirect,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,toastShow:this.toastShow})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:3===this.state.activeKey,children:(0,r.jsx)(R,{handleRedirect:this.handleRedirect,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,toastShow:this.toastShow})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:4===this.state.activeKey,children:(0,r.jsx)(I,{handleRedirect:this.handleRedirect,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,toastShow:this.toastShow})}),(0,r.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"contact-tab",visible:5===this.state.activeKey,children:(0,r.jsx)(_,{handleRedirect:this.handleRedirect,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,toastShow:this.toastShow})})]})})]})]})}}const X=L},6898:(e,t,s)=>{s(2791),s(184)},2439:(e,t,s)=>{s.d(t,{q:()=>n});const n=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"]}}]);
//# sourceMappingURL=39.b0472a10.chunk.js.map