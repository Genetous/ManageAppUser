"use strict";(self.webpackChunkgenetous_manage_apps=self.webpackChunkgenetous_manage_apps||[]).push([[368],{168:(e,s,t)=>{t.r(s),t.d(s,{PublisherService:()=>R,default:()=>v});var i=t(2791),l=t(4880),a=(t(4846),t(577)),o=(t(6898),t(5462),t(8983)),n=t(184);const r={cursor:"pointer",color:"rgb(33, 37, 41)","background-color":"#fff"},d={color:"#f7f2f2"},c={float:"right"},h={height:"620px","overflow-y":"scroll"};class u extends i.Component{constructor(e){super(e),this.state={sendRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],changedTypes:[],visible:!1,yesNoVisible:!1,yesNoQuestion:"",arguments:[],sendType:""}}setSubActiveKey(e,s){const{subKeys:t}=this.state;var i=t.findIndex((e=>e.id===s));return t[i].activeKey=e,this.setState({subKeys:t}),!1}getSubActiveKey(e,s,t){const{subKeys:i}=this.state;var l=i.findIndex((e=>e.id===t));return s==i[l].activeKey}componentDidMount(){this.getPublisherRules()}async getPublisherRules(){var e={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),service:"publisherService",methodContentType:"other",methodType:"send"},s=this.state.sendRules;s=await this.props.getRules(e);var t=[];s.length>0&&s[0].roleRules.permissions.map((e=>{var s={id:e._id,activeKey:1};t.push(s)}));this.setState({sendRules:s,subKeys:t})}setVisible(e){this.setState({visible:e})}async setYesNoVisible(e,s,t,i,l){if(e)this.setState({yesNoVisible:e,yesNoQuestion:s,sendType:t,arguments:i});else{if(l)switch(this.state.sendType){case"deleteRole":await this.deleteRole(this.state.arguments);break;case"saveAll":await this.addUpdateRule()}this.setState({yesNoVisible:e,yesNoQuestion:"",sendType:"",arguments:[]})}}async newRuleAdd(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=document.getElementById("newrule");if(!e.value)return this.props.toastShow("error","Role Name cannot be null or empty!"),!1;var s={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[{method:"/publisher/send",methodType:"send",methodContentType:"other",service:"publisherService",permissions:[{role:e.value,permitted:{mail:!1,notfication:!1},nonPermitted:{mail:!1,notfication:!1}}]}]};await this.props.newRuleAdd(s),this.getPublisherRules()}async addUpdateRule(){this.setVisible(!1),this.props.toastShow("info","Processing....");var e=[...this.state.sendRules][0].roleRules,s={method:e.method,methodType:e.methodType,methodContentType:e.methodContentType,service:e.service,permissions:e.permissions},t={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),rules:[s]};this.props.addUpdateRule(t)}async deleteRole(e){this.setVisible(!1),this.props.toastShow("info","Processing....");var s=e[0],t=e[1],i={organizationId:localStorage.getItem("orgId"),applicationId:localStorage.getItem("appId"),id:s};if(await this.props.deleteRole(i)){var l=[...this.state.sendRules];l[0].roleRules.permissions.splice(t,1),this.setState({sendRules:l})}}changed(e,s,t){var i=[...this.state.sendRules];i[0].roleRules.permissions[e][s][t.target.name]=t.target.checked;this.setState({sendRules:i})}render(){return(0,n.jsxs)(o.xH,{children:[(0,n.jsxs)(o.rb,{className:"m-2 border-bottom d-flex align-items-center",children:[(0,n.jsx)(o.b7,{className:"col-6 pb-2",children:(0,n.jsxs)(o.tj,{children:["Add/Update ",(0,n.jsx)("b",{children:'"Publisher Send"'})," Permissions"]})}),(0,n.jsxs)(o.b7,{className:"col-6 d-grid gap-2 d-md-flex justify-content-md-end pb-2",children:[(0,n.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!0),children:"Add New Role"}),(0,n.jsx)(o.u5,{color:"info",style:{color:"#fff"},onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to save all?","saveAll",[this]),children:"Save All"})]}),(0,n.jsxs)(o.Tk,{visible:this.state.visible,onClose:this.setVisible.bind(this,!1),children:[(0,n.jsx)(o.p0,{children:(0,n.jsx)(o.fl,{children:"Add New Role"})}),(0,n.jsx)(o.sD,{children:(0,n.jsx)(o.jO,{type:"text",placeholder:"Role Name",name:"newRule",id:"newrule"})}),(0,n.jsxs)(o.Ym,{children:[(0,n.jsx)(o.u5,{color:"secondary",onClick:this.setVisible.bind(this,!1),children:"Close"}),(0,n.jsx)(o.u5,{color:"primary",onClick:this.newRuleAdd.bind(this),children:"Create Role"})]})]}),(0,n.jsxs)(o.Tk,{visible:this.state.yesNoVisible,onClose:this.setYesNoVisible.bind(this,!1),children:[(0,n.jsx)(o.p0,{children:(0,n.jsx)(o.fl,{children:this.state.yesNoQuestion})}),(0,n.jsxs)(o.Ym,{children:[(0,n.jsx)(o.u5,{color:"secondary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!1),children:"No"}),(0,n.jsx)(o.u5,{color:"primary",onClick:this.setYesNoVisible.bind(this,!1,null,null,null,!0),children:"Yes"})]})]})]}),(0,n.jsx)(o.sl,{style:h,children:this.state.sendRules.length>0&&this.state.sendRules[0].roleRules.permissions.map(((e,s)=>(0,n.jsx)(o.xH,{className:"mt-1",children:(0,n.jsxs)(o.sl,{children:[(0,n.jsxs)(o.tj,{children:[(0,n.jsxs)("b",{children:['"',e.role,'"']})," Rules  ",(0,n.jsx)("span",{style:c,children:(0,n.jsx)(o.u5,{color:"danger",onClick:this.setYesNoVisible.bind(this,!0,"Are you sure you want to delete "+e.role+" role?","deleteRole",[e._id,s,this]),style:d,children:"Delete Role"})})]}),(0,n.jsxs)(o.n2,{variant:"tabs",className:"mt-4",role:"tablist",style:r,children:[(0,n.jsx)(o.U6,{children:(0,n.jsx)(o.AQ,{style:r,active:this.getSubActiveKey(this,1,e._id),onClick:this.setSubActiveKey.bind(this,1,e._id),children:"Permitted"})}),(0,n.jsx)(o.U6,{children:(0,n.jsx)(o.AQ,{style:r,active:this.getSubActiveKey(this,2,e._id),onClick:this.setSubActiveKey.bind(this,2,e._id),children:"Non-Permitted"})})]}),(0,n.jsxs)(o.gr,{children:[(0,n.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"home-tab",visible:this.getSubActiveKey(this,1,e._id),children:(0,n.jsxs)(o.xH,{className:"mt-2",children:[(0,n.jsx)(o.bn,{children:(0,n.jsx)(o.tj,{className:"p-2",children:"Choose permitted notification types"})}),(0,n.jsx)(o.sl,{children:Object.keys(e.permitted).map(((t,i)=>(0,n.jsx)(o.EC,{onChange:this.changed.bind(this,s,"permitted"),label:t.charAt(0).toUpperCase()+t.slice(1),name:t,checked:e.permitted[t]})))})]})}),(0,n.jsx)(o.IA,{role:"tabpanel",className:"p-3","aria-labelledby":"profile-tab",visible:this.getSubActiveKey(this,2,e._id),children:(0,n.jsxs)(o.xH,{className:"mt-2",children:[(0,n.jsx)(o.bn,{children:(0,n.jsx)(o.tj,{className:"p-2",children:"Choose non-permitted notification types"})}),(0,n.jsx)(o.sl,{children:Object.keys(e.nonPermitted).map(((t,i)=>(0,n.jsx)(o.EC,{onChange:this.changed.bind(this,s,"nonPermitted"),label:t.charAt(0).toUpperCase()+t.slice(1),name:t,checked:e.nonPermitted[t]})))})]})})]})]})})))})]})}}const p=u;var m=t(4889);const b={cursor:"pointer",color:"rgba(33, 37, 41,0.8)","background-color":"#fff"},g={cursor:"pointer","background-color":"rgba(33, 37, 41,0.8)",color:"#fff"};var y="";class R extends i.Component{constructor(e){super(e),this.state={permissionItems:["Send E-Mail/Notification"],collectionCreateRules:[],activeKey:1,activeSubKeys:[1,1,1,1,1],subKeys:[],redirect:!1,sendApp:!1},this.handleRedirect=this.handleRedirect.bind(this),this.newRuleAdd=this.newRuleAdd.bind(this),this.deleteRole=this.deleteRole.bind(this),this.addUpdateRule=this.addUpdateRule.bind(this),this.getRules=this.getRules.bind(this),this.toastShow=this.toastShow.bind(this)}handleRedirectApp(){this.state.sendApp||this.setState({sendApp:!0})}componentDidMount(){for(var e=["clientId","organizationId","applicationId"],s=0;s<e.length;++s){var t=e[s];if(null==localStorage.getItem(t)||""==localStorage.getItem(t))return void this.handleRedirect()}var i=["appId","orgId"];for(s=0;s<i.length;++s){t=i[s];if(null==localStorage.getItem(t)||""==localStorage.getItem(t))return void this.handleRedirectApp()}Date.now()/1e3-localStorage.getItem("timeout")/1e3>3600&&(localStorage.setItem("token",""),this.handleRedirect())}handleRedirect(e){this.state.redirect||this.setState({redirect:!0})}setActiveKey(e){return this.setState({activeKey:e}),!1}async newRuleAdd(e){var s=document.getElementById("newrule");if(!s.value)return this.toastShow("error","Role Name cannot be null or empty!"),!1;var t=!1;await(0,m.Rd)(e,m.fq.AddUpdateRules).then((function(e){t=e.success,y=1==e.success?"Role Rule Created!":e.message}),(e=>{401==e.status?this.handleRedirect():(t=!1,y=e.message)}));var i=t?"success":"error";return this.toastShow(i,y),s.value="",!0}async deleteRole(e){var s=!1;await(0,m.Rd)(e,m.fq.DeleteRule).then((function(e){s=e.success,y=1==e.success?"Role Deleted":e.message}),(e=>{401==e.status?this.handleRedirect():(s=!1,y=e.message)}));var t=s?"success":"error";return this.toastShow(t,y),!!s}async addUpdateRule(e){console.log(e);var s=!0;await(0,m.Rd)(e,m.fq.AddUpdateRules).then((function(e){s=e.success,y=1==e.success?"Saved!":e.message}),(e=>{401==e.status?this.handleRedirect():(s=!1,y=e.message)}));var t=s?"success":"error";this.toastShow(t,y)}async getRules(e){var s=[];await(0,m.Rd)(e,m.fq.GetRules).then((function(e){e.length>0&&e[0].hasOwnProperty("roleRules")&&(s=e)}),(e=>{401==e.status?this.handleRedirect():(!1,y=e.message)}));return s}toastShow(e,s){switch(e){case"success":a.Am.success(s,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:a.Mi});break;case"error":a.Am.error(s,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:a.Mi});break;case"info":a.Am.info(s,{position:"bottom-center",autoClose:1e3,hideProgressBar:!0,closeOnClick:!1,pauseOnHover:!1,draggable:!1,theme:"dark",transition:a.Mi})}}render(){const{redirect:e}=this.state,{sendApp:s}=this.state;return e?(0,n.jsx)(l.l_,{to:"/login"}):s?(0,n.jsx)(l.l_,{to:"/applications"}):(0,n.jsxs)(o.KB,{className:"p-5",children:[(0,n.jsx)(a.Ix,{}),(0,n.jsxs)(o.rb,{children:[(0,n.jsx)(o.b7,{className:"col-3",children:(0,n.jsx)(o.n2,{className:"flex-column",role:"tablist",style:b,children:this.state.permissionItems.map(((e,s)=>(0,n.jsx)(o.U6,{children:(0,n.jsx)(o.AQ,{style:this.state.activeKey===s+1?g:b,active:this.state.activeKey===s+1,onClick:this.setActiveKey.bind(this,s+1),children:e})})))})}),(0,n.jsx)(o.b7,{className:"col-9 justify-content-center",children:(0,n.jsx)(o.gr,{children:(0,n.jsx)(o.IA,{role:"tabpanel","aria-labelledby":"home-tab",visible:1===this.state.activeKey,children:(0,n.jsx)(p,{handleRedirect:this.handleRedirect,newRuleAdd:this.newRuleAdd,deleteRole:this.deleteRole,addUpdateRule:this.addUpdateRule,getRules:this.getRules,toastShow:this.toastShow})})})})]})]})}}const v=R},6898:(e,s,t)=>{t(2791),t(184)}}]);
//# sourceMappingURL=368.7a80311c.chunk.js.map